<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Golang on ç»çŸ¥</title>
    <link>https://www.yici.xin/tags/golang/</link>
    <description>Recent content in Golang on ç»çŸ¥</description>
    <image>
      <url>https://www.yici.xin/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://www.yici.xin/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Mon, 05 Feb 2024 09:43:27 +0800</lastBuildDate><atom:link href="https://www.yici.xin/tags/golang/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Golang Sqlæºç è§£æ</title>
      <link>https://www.yici.xin/post/tech/golang-sql%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</link>
      <pubDate>Mon, 05 Feb 2024 09:43:27 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golang-sql%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ç¯å¢ƒä¿¡æ¯ï¼šgo1.21.5 amd64&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æŠ½è±¡å®šä¹‰&#34;&gt;æŠ½è±¡å®šä¹‰&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;database/sql&lt;/code&gt;åº“æ˜¯goæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæœ¬èº«ä¸æä¾›æ•°æ®åº“é©±åŠ¨ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€å¥—è½»é‡çº§çš„æ¥å£æ¥ä¸SQLæˆ–ç±»SQLçš„æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œç”±å¦‚ä¸‹æ ¸å¿ƒæ¥å£ç»„æˆï¼š&lt;/p&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;

&lt;head&gt;
    &lt;style type=&#34;text/css&#34;&gt;
        #chart {
            padding-bottom: 66%;
            position: relative;
            display: block;
            width: 100%;
            border-bottom: 5px solid;
        }

        #chart iframe {
            position: absolute;
            top: 0;
            left: 0
        }
    &lt;/style&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id=&#34;chart&#34;&gt;
        &lt;iframe id=&#34;embed_dom&#34; width=100% height=100%  name=&#34;embed_dom&#34; frameborder=&#34;0&#34; src=&#34;https://www.processon.com/embed/650310e17d9f2e3df554e309&#34;&gt;&lt;/iframe&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
&lt;h3 id=&#34;connector&#34;&gt;Connector&lt;/h3&gt;
&lt;p&gt;Connectoræ˜¯è¿æ¥å™¨çš„æŠ½è±¡ï¼Œç”¨äºè·å–è¿æ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// /src/database/sql/driver/driver.go:121&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// ä¸€ä¸ªConnectorä»£è¡¨ä¸€ä¸ªå›ºå®šé…ç½®çš„é©±åŠ¨ï¼Œèƒ½å¤Ÿåˆ›å»ºä»»æ„æ•°é‡çš„ã€ç­‰ä»·çš„è¿æ¥ç»™å¤šä¸ªåç¨‹ä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// Connectorå¯ä»¥ä¼ é€’ç»™sql.OpenDBå‡½æ•°ï¼Œè®©æ¯ç§æ•°æ®åº“å®ç°å„è‡ªçš„*sql.DB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœConnectorå®ç°äº†io.Closerï¼Œä¼šåœ¨sql.DBçš„Closeæ–¹æ³•æœ€åè°ƒç”¨Close()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; Connector &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;interface&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// Connect è¿”å›ä¸€ä¸ªæ•°æ®åº“è¿æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// sqlåº“æœ‰ç©ºé—²è¿æ¥æ± æœºåˆ¶ï¼Œç”¨äºè¿æ¥é‡ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// contextä»…ç”¨äºæ‹¨å·ç›®çš„ï¼ˆè§ net.DialContextï¼‰ï¼Œä¸åº”å­˜å‚¨æˆ–ç”¨äºå…¶ä»–ç›®çš„ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// ä¸€ä¸ªé»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºè¿æ¥æ± å¯èƒ½ä¼šå¼‚æ­¥è°ƒç”¨Connectæ–¹æ³•æ¥å¤„ç†æŸ¥è¯¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// è¿”å›çš„è¿æ¥åŒä¸€æ—¶åˆ»åªèƒ½ç»™ä¸€ä¸ªgoroutineä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#50fa7b&#34;&gt;Connect&lt;/span&gt;(context.Context) (Conn, &lt;span style=&#34;color:#8be9fd&#34;&gt;error&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// Driveræ–¹æ³•è¿”å›Connectorçš„åº•å±‚Driverï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸sql.DBä¸Šçš„Driveræ–¹æ³•ä¿æŒå…¼å®¹ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#50fa7b&#34;&gt;Driver&lt;/span&gt;() Driver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;driver-é©±åŠ¨&#34;&gt;Driver é©±åŠ¨&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// Driveræ˜¯æ•°æ®åº“é©±åŠ¨ç¨‹åºå¿…é¡»å®ç°çš„æ¥å£ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// æ•°æ®åº“é©±åŠ¨ç¨‹åºå¯ä»¥å®ç°DriverContextæ¥è®¿é—®ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”åªéœ€å¯¹è¿æ¥æ± ä¸­çš„è¿æ¥è§£æä¸€æ¬¡åç§°ï¼Œè€Œä¸æ˜¯æ¯ä¸ªè¿æ¥éƒ½è§£æä¸€æ¬¡ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// /src/database/sql/driver/driver.go:84&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; Driver &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;interface&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// Open è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// è¯¥åç§°æ˜¯ä¸€ä¸ªç‰¹å®šé©±åŠ¨ç¨‹åºæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚å¦‚username:passpord@(ip:port)/database&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#50fa7b&#34;&gt;Open&lt;/span&gt;(name &lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;) (Conn, &lt;span style=&#34;color:#8be9fd&#34;&gt;error&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;conn-è¿æ¥&#34;&gt;Conn è¿æ¥&lt;/h3&gt;
&lt;p&gt;Connæ˜¯è¿æ¥çš„æŠ½è±¡&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>è½¬æ¢byteså’Œstringçš„æœ€ä½³å®è·µ</title>
      <link>https://www.yici.xin/post/tech/%E8%BD%AC%E6%8D%A2bytes%E5%92%8Cstring%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</link>
      <pubDate>Wed, 01 Feb 2023 19:34:04 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/%E8%BD%AC%E6%8D%A2bytes%E5%92%8Cstring%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡golangæºç ä¸º1.18ç‰ˆæœ¬&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ ‡å‡†è½¬æ¢&#34;&gt;æ ‡å‡†è½¬æ¢&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨æ ‡å‡†è½¬æ¢æ˜¯æœ€å¸¸è§çš„é€‰æ‹©&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;package&lt;/span&gt; main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	s &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Hello, world!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	&lt;span style=&#34;color:#6272a4&#34;&gt;// stringè½¬byteæ•°ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	b &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; []&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;byte&lt;/span&gt;(s)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	&lt;span style=&#34;color:#6272a4&#34;&gt;// byteæ•°ç»„è½¬string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	s2 &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;string&lt;/span&gt;(b)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥è½¬æ¢è¯­å¥ä¼šè¢«goç¼–è¯‘å™¨ç¿»è¯‘ä¸ºruntimeå±‚çš„æ–¹æ³•è°ƒç”¨ï¼Œå…¶ä¸­&lt;code&gt;[]byte&lt;/code&gt;åˆ°&lt;code&gt;string&lt;/code&gt;çš„è½¬æ¢å¯¹åº”&lt;code&gt;/src/runtime/string.go:81&lt;/code&gt;å¤„çš„&lt;code&gt;slicebytetostring&lt;/code&gt;å‡½æ•°ï¼›è€Œ&lt;code&gt;string&lt;/code&gt;åˆ°&lt;code&gt;[]byte&lt;/code&gt;çš„è½¬æ¢å¯¹åº”çš„åˆ™æ˜¯&lt;code&gt;/src/runtime/string.go:172&lt;/code&gt;å¤„çš„&lt;code&gt;stringtoslicebyte&lt;/code&gt;å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥çœ‹çœ‹æ¯”è¾ƒç®€å•çš„&lt;code&gt;stringtoslicebyte&lt;/code&gt;å‡½æ•°ï¼Œ&lt;code&gt;tmpBuf&lt;/code&gt;ç±»å‹æ˜¯ä¸ªå¤§å°ä¸º32çš„&lt;code&gt;byte&lt;/code&gt;æ•°ç»„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// The constant is known to the compiler.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// There is no fundamental theory behind this number. ğŸ¤£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;const&lt;/span&gt; tmpStringBufSize = &lt;span style=&#34;color:#bd93f9&#34;&gt;32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; tmpBuf [tmpStringBufSize]&lt;span style=&#34;color:#8be9fd&#34;&gt;byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;stringtoslicebyte&lt;/span&gt;(buf &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;tmpBuf, s &lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;) []&lt;span style=&#34;color:#8be9fd&#34;&gt;byte&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;var&lt;/span&gt; b []&lt;span style=&#34;color:#8be9fd&#34;&gt;byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; buf &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;len&lt;/span&gt;(s) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;len&lt;/span&gt;(buf) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;buf = tmpBuf{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		b = buf[:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;len&lt;/span&gt;(s)]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	} &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœæ²¡æœ‰ç¼“å†²åŒºæˆ–ç¼“å†²åŒºå¤§å°ä¸è¶³ï¼Œéœ€è¦ç”³è¯·å†…å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		b = &lt;span style=&#34;color:#50fa7b&#34;&gt;rawbyteslice&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;len&lt;/span&gt;(s))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// å¤åˆ¶æ•°æ®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;copy&lt;/span&gt;(b, s)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; b
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;rawbyteslice&lt;/span&gt;(size &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;) (b []&lt;span style=&#34;color:#8be9fd&#34;&gt;byte&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// å®¹é‡è®¡ç®—ï¼Œè€ƒè™‘å†…å­˜å¯¹é½ï¼Œå¯»æ‰¾å¤§å°æœ€åŒ¹é…çš„å†…å­˜å—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	cap &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;roundupsize&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(size))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// ä½¿ç”¨mallocgcç”³è¯·å¯¹åº”å¤§å°çš„å†…å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	p &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;mallocgc&lt;/span&gt;(cap, &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#ff79c6&#34;&gt;false&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœè¦ç”³è¯·çš„sizeå’Œæœ€ç»ˆè®¡ç®—å¾—åˆ°çš„capå¤§å°ä¸ä¸€è‡´ï¼Œcapåªä¼šæ¯”sizeæ›´å¤§ï¼Œæ¸…ç†æ‰å¤šä½™çš„å†…å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; cap &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(size) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#50fa7b&#34;&gt;memclrNoHeapPointers&lt;/span&gt;(&lt;span style=&#34;color:#50fa7b&#34;&gt;add&lt;/span&gt;(p, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(size)), cap&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(size))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// å°†bæŒ‡å‘è¿™ç‰‡ç”³è¯·å¥½çš„å†…å­˜ã€‚è¯¥sliceä¸ä¸ºç©ºï¼Œæ•…å¤–éƒ¨ä½¿ç”¨copyè¿›è¡Œè¦†ç›–è€Œä¸æ˜¯append&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;slice)(unsafe.&lt;span style=&#34;color:#50fa7b&#34;&gt;Pointer&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;b)) = slice{p, size, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;int&lt;/span&gt;(cap)}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“éœ€è¦è½¬æ¢çš„å­—ç¬¦ä¸²é•¿åº¦å°äº32æ—¶ï¼Œåªä¼šè¿›è¡Œå†…å­˜å¤åˆ¶ï¼Œè€Œå¤§äº32çš„è¯ï¼Œé™¤äº†å¤åˆ¶æ“ä½œï¼Œè¿˜éœ€è¦åˆ†é…å†…å­˜ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Golangâ€”â€”plan9æ±‡ç¼–</title>
      <link>https://www.yici.xin/post/tech/golangplan9%E6%B1%87%E7%BC%96/</link>
      <pubDate>Fri, 30 Dec 2022 10:51:52 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golangplan9%E6%B1%87%E7%BC%96/</guid>
      <description>&lt;h2 id=&#34;åŸºæœ¬æŒ‡ä»¤&#34;&gt;åŸºæœ¬æŒ‡ä»¤&lt;/h2&gt;
&lt;h3 id=&#34;æ ˆç›¸å…³&#34;&gt;æ ˆç›¸å…³&lt;/h3&gt;
&lt;p&gt;åœ¨ plan9 æ±‡ç¼–ä¸­ï¼Œè™½ç„¶å­˜åœ¨&lt;code&gt;pushã€pop&lt;/code&gt;æŒ‡ä»¤ï¼Œä½†æ˜¯åœ¨ç”Ÿæˆçš„ä»£ç ä¸­ä¸€èˆ¬æ˜¯çœ‹ä¸åˆ°çš„ï¼Œé€šå¸¸æ ˆçš„è¿™ä¸¤ç§æ“ä½œä¼šä»¥æ“ä½œ&lt;code&gt;SP&lt;/code&gt;å¯„å­˜å™¨çš„ä½ç½®æ¥æ›¿æ¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;SUBQ $&lt;span style=&#34;color:#bd93f9&#34;&gt;0x18&lt;/span&gt;, SP &lt;span style=&#34;color:#6272a4&#34;&gt;// å¯¹ SP åšå‡æ³•ï¼Œä¸ºå‡½æ•°åˆ†é…å‡½æ•°æ ˆå¸§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;...&lt;/span&gt;               &lt;span style=&#34;color:#6272a4&#34;&gt;// çœç•¥æ— ç”¨ä»£ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ADDQ $&lt;span style=&#34;color:#bd93f9&#34;&gt;0x18&lt;/span&gt;, SP &lt;span style=&#34;color:#6272a4&#34;&gt;// å¯¹ SP åšåŠ æ³•ï¼Œæ¸…é™¤å‡½æ•°æ ˆå¸§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ˆçš„æ–¹å‘æ˜¯ä»å†…å­˜é«˜ä½ç½®å‘ä½ä½ç½®çš„ï¼Œæ‰€ä»¥å¯¹ SP å¯„å­˜å™¨åšå‡æ³•ï¼Œå°±æ˜¯ç»™æ ˆåˆ†é…å†…å­˜ï¼ŒåŠ æ³•å³å›æ”¶å†…å­˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;x86 æ±‡ç¼–ä¸­ push å’Œ pop æŒ‡ä»¤å¯ä»¥æ¥ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå¦‚ pop axï¼Œè¡¨ç¤ºå°†æ ˆé¡¶å…ƒç´ æ”¾å…¥ ax å¯„å­˜å™¨å¹¶ä¸”æ ˆé¡¶å¯„å­˜å™¨è‡ªåŠ¨å›é€€ï¼Œè€Œ plan9 åªæ˜¯åšäº†æ ˆé¡¶å¯„å­˜å™¨æ“ä½œï¼Œå¯¹äºèµ‹å€¼æ“ä½œéœ€è¦ä½¿ç”¨ mov æŒ‡ä»¤ ğŸ˜­&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ•°æ®æ¬è¿&#34;&gt;æ•°æ®æ¬è¿&lt;/h3&gt;
&lt;p&gt;plan9 æ±‡ç¼–ä¸­ï¼Œå¸¸æ•°ä»¥&lt;code&gt;$num&lt;/code&gt;å½¢å¼è¡¨ç¤ºï¼Œå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œä¸€èˆ¬ä¸º 10 è¿›åˆ¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨&lt;code&gt;$0x123&lt;/code&gt;çš„åå…­è¿›åˆ¶å½¢å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;MOVB $&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;, DI      &lt;span style=&#34;color:#6272a4&#34;&gt;// 1 byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;MOVW $&lt;span style=&#34;color:#bd93f9&#34;&gt;0x10&lt;/span&gt;, BX   &lt;span style=&#34;color:#6272a4&#34;&gt;// 2 bytes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;MOVD $&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;, DX      &lt;span style=&#34;color:#6272a4&#34;&gt;// 4 bytes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;MOVQ $&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;10&lt;/span&gt;, AX     &lt;span style=&#34;color:#6272a4&#34;&gt;// 8 bytes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;plan9 æ±‡ç¼–ä¸­ä½¿ç”¨çš„é€šå¸¸æ˜¯å¸¦æœ‰åç¼€çš„ MOV æŒ‡ä»¤ï¼Œä¸åŒåç¼€çš„åŒºåˆ«æ˜¯ç§»åŠ¨çš„å­—èŠ‚å¤§å°ã€‚è¿™å’Œ x86 çš„æ±‡ç¼–ä¸ä¸€æ ·ï¼Œåœ¨ x86 æ±‡ç¼–ä¸­ï¼Œå†³å®šç§»åŠ¨å­—èŠ‚å¤§å°çš„æ˜¯å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“ç„¶ï¼Œè¿˜æœ‰ä¸ªæœ€æ˜æ˜¾çš„å·®å¼‚æ˜¯ plan9 çš„æ“ä½œæ•°å’Œ x86 æ˜¯ç›¸åçš„ï¼Œx86 æ±‡ç¼–çš„ mov æ˜¯å°†å³å€¼ç§»åŠ¨åˆ°å·¦éƒ¨å¯„å­˜å™¨ï¼Œè€Œ plan9 æ˜¯ç›¸åçš„ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Golang-mapçš„æ“ä½œ</title>
      <link>https://www.yici.xin/post/tech/golang-map%E7%9A%84%E6%93%8D%E4%BD%9C/</link>
      <pubDate>Fri, 30 Dec 2022 10:49:41 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golang-map%E7%9A%84%E6%93%8D%E4%BD%9C/</guid>
      <description>&lt;h3 id=&#34;åˆ›å»º-map&#34;&gt;åˆ›å»º map&lt;/h3&gt;
&lt;p&gt;åˆ›å»º map çš„è¯­æ³•å¾ˆç®€å•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// ä¸æŒ‡å®šmapé•¿åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ageMp &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// æŒ‡å®šmapé•¿åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ageMp &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#bd93f9&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// ageMp ä¸º nilï¼Œä¸èƒ½å‘å…¶æ·»åŠ å…ƒç´ ï¼Œä¼šç›´æ¥panic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;var&lt;/span&gt; ageMp &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#8be9fd&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æ±‡ç¼–è¯­è¨€ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·Ÿè¸ªåˆ° map çš„åˆ›å»ºæœ€ç»ˆä¼šè°ƒç”¨ runtime.makemap æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// makemap implements Go map creation for make(map[k]v, hint).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// If the compiler has determined that the map or the first bucket&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// can be created on the stack, h and/or bucket may be non-nil.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// If h != nil, the map can be created directly in h.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// If h.buckets != nil, bucket pointed to can be used as the first bucket.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// ç¿»è¯‘ï¼šmakemapå®ç°äº†make(map[k]v, hint)è¿™ç§å½¢å¼è¯­æ³•çš„Go mapåˆ›å»ºã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœç¼–è¯‘å™¨å·²ç»ç¡®å®šè¯¥mapæˆ–è€…ç¬¬ä¸€ä¸ªbucketèƒ½å¤Ÿåœ¨è¿™ä¸ªæ ˆä¸Šåˆ›å»ºï¼Œé‚£ä¹ˆhå’Œ(æˆ–)bucketå¯èƒ½ä¸ºénilã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœhä¸æ˜¯nilï¼Œé‚£ä¹ˆè¯¥mapèƒ½ç›´æ¥åˆ›å»ºåœ¨è¿™ä¸ªhä¸Šã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœh.bucketsä¸æ˜¯nil, åˆ™è¢«æŒ‡å‘çš„bucketèƒ½è¢«ç”¨æ¥åšç¬¬ä¸€ä¸ªbucket&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;makemap&lt;/span&gt;(t &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;maptype, hint &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;, h &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;hmap) &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;hmap {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;// è®¡ç®—æŒ‡å®šçš„å¤§å°æ‰€éœ€è¦çš„å†…å®¹æ˜¯å¦è¶…å‡ºå‡ºç³»ç»Ÿå…è®¸çš„æœ€å¤§åˆ†é…å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    mem, overflow &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; math.&lt;span style=&#34;color:#50fa7b&#34;&gt;MulUintptr&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(hint), t.bucket.size)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; overflow &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; mem &amp;gt; maxAlloc {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        hint = &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// åˆå§‹åŒ–hmapï¼Œå¹¶æŒ‡å®šéšæœºç§å­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; h &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        h = &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;new&lt;/span&gt;(hmap)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    h.hash0 = &lt;span style=&#34;color:#50fa7b&#34;&gt;fastrand&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// Find the size parameter B which will hold the requested # of elements.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// For hint &amp;lt; 0 overLoadFactor returns false since hint &amp;lt; bucketCnt.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;// é€šè¿‡overLoadFactor(hint, B)å‡½æ•°æ‰¾åˆ°ä¸€ä¸ªèƒ½è£…ä¸‹æŒ‡å®šmapå¤§å°ä¸ªå…ƒç´ ä¸ªæ•°çš„æœ€å°Bï¼Œè¦æ»¡è¶³ è£…è½½å› å­*2^B &amp;lt; hint&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    B &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uint8&lt;/span&gt;(&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;overLoadFactor&lt;/span&gt;(hint, B) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        B&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    h.B = B
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// allocate initial hash table&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// if B == 0, the buckets field is allocated lazily later (in mapassign)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// If hint is large zeroing this memory could take a while.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;// å¼€å§‹å¯¹hash tableè¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚æœB==0åˆ™buckets è¿›è¡Œæ‡’åˆå§‹åŒ–æ“ä½œï¼ˆèµ‹å€¼çš„æ—¶å€™æ‰è¿›è¡Œåˆå§‹åŒ–ï¼‰ï¼Œå¦‚æœBå€¼ç‰¹åˆ«å¤§ï¼Œåˆ™åˆå§‹åŒ–éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œä¸»è¦é€šè¿‡ makeBucketArray() å‡½æ•°å®ç°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; h.B &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;var&lt;/span&gt; nextOverflow &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;bmap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        h.buckets, nextOverflow = &lt;span style=&#34;color:#50fa7b&#34;&gt;makeBucketArray&lt;/span&gt;(t, h.B, &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; nextOverflow &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            h.extra = &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;new&lt;/span&gt;(mapextra)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;// æº¢å‡ºæ¡¶åœ°å€èµ‹å€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            h.extra.nextOverflow = nextOverflow
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; h
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// makeBucketArray initializes a backing array for map buckets.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// 1&amp;lt;&amp;lt;b is the minimum number of buckets to allocate.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// dirtyalloc should either be nil or a bucket array previously&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// allocated by makeBucketArray with the same t and b parameters.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// If dirtyalloc is nil a new backing array will be alloced and&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// otherwise dirtyalloc will be cleared and reused as backing array.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// ç¿»è¯‘ï¼šmakeBucketArrayä¸ºmap bucketsåˆå§‹åŒ–ä¸€ä¸ªå¤‡ç”¨æ•°ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// 2^bæ˜¯è¯¥bucketsé•¿åº¦çš„æœ€å°å€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// dirtyallocä¹‹å‰åº”è¯¥æ˜¯nilæˆ–è€…bucketæ•°ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœdirtyalloc ä¸ºnilï¼Œå°†åˆ†é…ä¸€ä¸ªæ–°çš„åå¤‡æ•°ç»„ï¼Œå¦åˆ™å°†æ¸…é™¤dirtyalloc å¹¶ä½œä¸ºåå¤‡æ•°ç»„é‡ç”¨ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;makeBucketArray&lt;/span&gt;(t &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;maptype, b &lt;span style=&#34;color:#8be9fd&#34;&gt;uint8&lt;/span&gt;, dirtyalloc unsafe.Pointer) (buckets unsafe.Pointer, nextOverflow &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;bmap) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    base &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;bucketShift&lt;/span&gt;(b) &lt;span style=&#34;color:#6272a4&#34;&gt;// base = 2^b&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    nbuckets &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; base
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// For small b, overflow buckets are unlikely.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// Avoid the overhead of the calculation.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// å¯¹äºå°çš„bï¼Œä¸å¤ªå¯èƒ½ä¼šéœ€è¦æº¢å‡ºæ¡¶ï¼Œå¯ä»¥é¿å…è¿™éƒ¨åˆ†è®¡ç®—å¼€é”€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// å¯¹äºb&amp;gt;4ï¼ˆæ¡¶çš„æ•°é‡&amp;gt; 2^4ï¼‰çš„è¯ï¼Œåˆ™éœ€è¦åˆ›å»º2^(b-4)ä¸ªæº¢å‡ºæ¡¶ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; b &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// åŠ ä¸Šæº¢å‡ºæ¡¶çš„æ•°é‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        nbuckets &lt;span style=&#34;color:#ff79c6&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;bucketShift&lt;/span&gt;(b &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// æ€»å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sz &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; t.bucket.size &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; nbuckets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// é’ˆå¯¹æ‰€éœ€è¦çš„å†…å­˜å¤§å°ï¼Œmallocgcå°†åˆ†é…çš„å†…å­˜å—å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        up &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;roundupsize&lt;/span&gt;(sz)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; up &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; sz {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœæ€»å¤§å°å’Œmallocgcå°†åˆ†é…çš„å†…å­˜å—å¤§å°ä¸åŒï¼Œä»¥mallocgcåˆ†é…çš„ä¸ºå‡†ï¼Œè®¡ç®—nbuckets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nbuckets = up &lt;span style=&#34;color:#ff79c6&#34;&gt;/&lt;/span&gt; t.bucket.size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; dirtyalloc &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        buckets = &lt;span style=&#34;color:#50fa7b&#34;&gt;newarray&lt;/span&gt;(t.bucket, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;int&lt;/span&gt;(nbuckets))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// dirtyalloc was previously generated by&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// the above newarray(t.bucket, int(nbuckets))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// but may not be empty.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        buckets = dirtyalloc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        size &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; t.bucket.size &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; nbuckets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; t.bucket.ptrdata &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;memclrHasPointers&lt;/span&gt;(buckets, size)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;memclrNoHeapPointers&lt;/span&gt;(buckets, size)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; base &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; nbuckets {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// We preallocated some overflow buckets.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// To keep the overhead of tracking these overflow buckets to a minimum,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// we use the convention that if a preallocated overflow bucket&amp;#39;s overflow&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// pointer is nil, then there are more available by bumping the pointer.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// We need a safe non-nil pointer for the last overflow bucket; just use buckets.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// æˆ‘ä»¬æå‰åˆ†é…äº†ä¸€äº›æº¢å‡ºæ¡¶ï¼Œä¸ºäº†ä½¿å¾—è¿½è¸ªæº¢å‡ºæ¡¶çš„å¼€é”€æœ€å°ï¼Œæˆ‘ä»¬è¿™æ ·çº¦å®š:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// å¦‚æœæº¢å‡ºæ¡¶çš„overflowæŒ‡é’ˆä¸ºnilï¼Œé‚£ä¹ˆä»£è¡¨è¿˜æœ‰ç©ºé—´åœ¨å‡ºç°å“ˆå¸Œç¢°æ’æ—¶ä½¿ç”¨ï¼Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// æº¢å‡ºæ¡¶çš„æœ€åä¸€ä¸ªæ¡¶çš„overflowéœ€è¦æŒ‡å‘ä¸€ä¸ªå®‰å…¨çš„éç©ºæŒ‡é’ˆï¼Œè¿™é‡ŒæŒ‡å‘äº†bucketsçš„ç¬¬ä¸€ä¸ªæ¡¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// å…·ä½“çš„ç”¨å¤„åœ¨mapå†™å…¥æ—¶ï¼Œéœ€è¦åˆ›å»ºæº¢å‡ºæ¡¶æ—¶ä¼šç”¨åˆ°ï¼Œå…·ä½“åœ¨newoverflowå‡½æ•°ä¸­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        nextOverflow = (&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;bmap)(&lt;span style=&#34;color:#50fa7b&#34;&gt;add&lt;/span&gt;(buckets, base&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(t.bucketsize))) &lt;span style=&#34;color:#6272a4&#34;&gt;// æŒ‡å‘ç¬¬ä¸€ä¸ªæº¢å‡ºæ¡¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        last &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;bmap)(&lt;span style=&#34;color:#50fa7b&#34;&gt;add&lt;/span&gt;(buckets, (nbuckets&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uintptr&lt;/span&gt;(t.bucketsize))) &lt;span style=&#34;color:#6272a4&#34;&gt;// æŒ‡å‘æœ€åä¸€ä¸ªæº¢å‡ºæ¡¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        last.&lt;span style=&#34;color:#50fa7b&#34;&gt;setoverflow&lt;/span&gt;(t, (&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;bmap)(buckets)) &lt;span style=&#34;color:#6272a4&#34;&gt;// æº¢å‡ºæ¡¶çš„æœ€åä¸€ä¸ªæ¡¶çš„overflowæŒ‡å‘äº†bucketsçš„ç¬¬ä¸€ä¸ªæ¡¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; buckets, nextOverflow
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢ä»£ç å¯ä»¥å¾—çŸ¥ï¼Œ2^B å¹¶ä¸ç­‰äº buckets çš„å¤§å°ï¼Œå®ƒåªæ˜¯åˆ›å»º buckets æ—¶çš„ base éƒ¨åˆ†ï¼Œåœ¨è¯¥éƒ¨åˆ†åï¼Œè¿˜æœ‰æº¢å‡ºæ¡¶ã€‚æ‰€ä»¥æ­£å¸¸æ¡¶å’Œæº¢å‡ºæ¡¶åœ¨å†…å­˜ä¸Šçš„åˆ†å¸ƒæ˜¯è¿ç»­çš„ï¼Œæº¢å‡ºæ¡¶çš„æŒ‡é’ˆè®°å½•åœ¨äº† hmap çš„ extra å­—æ®µä¸­ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Golangè¯»å†™é”</title>
      <link>https://www.yici.xin/post/tech/golang%E8%AF%BB%E5%86%99%E9%94%81/</link>
      <pubDate>Tue, 27 Dec 2022 18:26:23 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golang%E8%AF%BB%E5%86%99%E9%94%81/</guid>
      <description>&lt;p&gt;ä¹‹å‰å†™è¿‡å…³äºäº’æ–¥é”çš„å†…å®¹ï¼Œ
&lt;div style=&#34;height: 200px;margin: 1em auto;position: relative;
        box-shadow: 0 2px 4px rgb(0 0 0 / 25%), 0 0 2px rgb(0 0 0 / 25%);
        border-radius: 15px;padding: 23px;max-width: 780px;background: var(--entry);&#34;&gt;
    
    
    &lt;div style=&#34;font-size: 22px; font-weight: 600&#34;&gt;
        &lt;a target=&#34;_blank&#34; href=&#34;https://www.yici.xin/post/tech/golang%E4%BA%92%E6%96%A5%E9%94%81/&#34; style=&#34;box-shadow: none&#34;&gt;Golangäº’æ–¥é”-Mutex&lt;/a&gt;
    &lt;/div&gt;
    &lt;span style=&#34;font-size: 14px; color: #999&#34;&gt;
        æ—¥æœŸ: 2022-12-27
        &amp;nbsp;
        æ ‡ç­¾:
        
        #golang&amp;nbsp;
        
        #é”&amp;nbsp;
        
        #æºç è§£æ&amp;nbsp;
        
    &lt;/span&gt;
    &lt;div style=&#34;font-size: 14px; line-height: 1.825;max-height: 75px; overflow: hidden;margin-top: 5px;&#34;&gt;
        äº’æ–¥é”ç»“æ„ // A Mutex is a mutual exclusion lock. // The zero value for a Mutex is an unlocked mutex. // // A Mutex must not be copied after first use. type Mutex struct { state int32 sema uint32 } stateè¡¨ç¤ºå½“å‰äº’æ–¥é”çš„çŠ¶æ€ï¼ŒÂ semaæ˜¯ç”¨äºæ§åˆ¶é”çŠ¶æ€çš„ä¿¡å·é‡
åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œäº’æ–¥é”çš„æ‰€æœ‰çŠ¶æ€ä½éƒ½æ˜¯ 0ï¼Œint32Â ä¸­çš„ä¸åŒä½åˆ†åˆ«è¡¨ç¤ºäº†ä¸åŒçš„çŠ¶æ€ï¼š
mutexLockedÂ â€” è¡¨ç¤ºäº’æ–¥é”çš„é”å®šçŠ¶æ€ï¼›
mutexWokenÂ â€” å”¤é†’æ¨¡å¼ï¼Œæ­¤æ—¶é‡Šæ”¾é”çš„gä¸ä¼šå”¤é†’ä¼‘çœ çš„gï¼›
mutexStarvingÂ â€” å½“å‰çš„äº’æ–¥é”è¿›å…¥é¥¥é¥¿çŠ¶æ€ï¼›
waitersCountÂ â€” å½“å‰äº’æ–¥é”ä¸Šç­‰å¾…çš„ Goroutine ä¸ªæ•°ï¼›
æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼çš„åŒºåˆ«:
åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œé”çš„ç­‰å¾…è€…ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè·å–é”ã€‚ä½†æ˜¯åˆšè¢«å”¤èµ·çš„ Goroutine ä¸æ–°åˆ›å»ºçš„ Goroutine ç«äº‰æ—¶ï¼Œå¤§æ¦‚ç‡ä¼šè·å–ä¸åˆ°é”ï¼Œä¸ºäº†å‡å°‘è¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œä¸€æ—¦ Goroutine è¶…è¿‡ 1ms æ²¡æœ‰è·å–åˆ°é”ï¼Œå®ƒå°±ä¼šå°†å½“å‰äº’æ–¥é”åˆ‡æ¢é¥¥é¥¿æ¨¡å¼ï¼Œé˜²æ­¢éƒ¨åˆ† Goroutine è¢«ã€é¥¿æ­»ã€ã€‚
 ......
    &lt;/div&gt;
    
    
&lt;/div&gt;
äº’æ–¥é”æ˜¯æœ€åŸºç¡€çš„é”ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•éœ€è¦é”çš„åœºæ™¯ä½¿ç”¨å®ƒï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸‡èƒ½çš„ï¼Œåœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–çš„é”æ¥è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œä¾‹å¦‚è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå°±æ›´é€‚åˆè¯»å†™é”ï¼Œè¿™ä¹Ÿæ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Golangå†…å­˜å›æ”¶</title>
      <link>https://www.yici.xin/post/tech/golang%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6/</link>
      <pubDate>Tue, 27 Dec 2022 18:26:23 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golang%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6/</guid>
      <description>&lt;h2 id=&#34;gcæºç åˆ†å¸ƒ&#34;&gt;GCæºç åˆ†å¸ƒ:&lt;/h2&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;æµç¨‹&lt;/strong&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;æ–‡ä»¶&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;æ ‡è®°å‡†å¤‡&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mgc.go&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;è°ƒæ­¥ç­–ç•¥&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mgcpacer.go&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;å¹¶å‘æ ‡è®°&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mgcmark.go&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;æ¸…æ‰«æµç¨‹&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/msweep.go&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ä½å›¾æ ‡è¯†&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mbitmap.go&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;è§¦å‘å±éšœ&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mbwbuf.go&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;å†…å­˜å›æ”¶&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mgcscavenge.go&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;gcè§¦å‘é“¾è·¯&#34;&gt;GCè§¦å‘é“¾è·¯:&lt;/h2&gt;
&lt;p&gt;è§¦å‘ GC çš„äº‹ä»¶ç±»å‹å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;ç±»å‹&lt;/strong&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;è§¦å‘äº‹ä»¶&lt;/strong&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;æ ¡éªŒæ¡ä»¶&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;gcTriggerHeap&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;åˆ†é…å¯¹è±¡æ—¶è§¦å‘&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;å †å·²åˆ†é…å†…å­˜è¾¾åˆ°é˜ˆå€¼&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;gcTriggerTime&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ç”± forcegchelper å®ˆæŠ¤åç¨‹å®šæ—¶è§¦å‘&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;æ¯2åˆ†é’Ÿè§¦å‘ä¸€æ¬¡&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;gcTriggerCycle&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ç”¨æˆ·è°ƒç”¨ runtime.GC æ–¹æ³•&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ä¸Šä¸€è½® GC å·²ç»“æŸ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è§¦å‘ç±»å‹çš„æºç :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; gcTriggerKind &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;// å †è§¦å‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	gcTriggerHeap gcTriggerKind = &lt;span style=&#34;color:#ff79c6&#34;&gt;iota&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;// å®šæ—¶è§¦å‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	gcTriggerTime
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;// æ‰‹åŠ¨è§¦å‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	gcTriggerCycle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// è¿›è¡Œè§¦å‘æ¡ä»¶çš„æ ¡éªŒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; (t gcTrigger) &lt;span style=&#34;color:#50fa7b&#34;&gt;test&lt;/span&gt;() &lt;span style=&#34;color:#8be9fd&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; !memstats.enablegc &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; panicking.&lt;span style=&#34;color:#50fa7b&#34;&gt;Load&lt;/span&gt;() &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; gcphase &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; _GCoff {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;switch&lt;/span&gt; t.kind {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; gcTriggerHeap:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// è§¦å‘å †å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		trigger, _ &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; gcController.&lt;span style=&#34;color:#50fa7b&#34;&gt;trigger&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// æ¯”è¾ƒå¤§å°æ˜¯å¦æ»¡è¶³&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; gcController.heapLive.&lt;span style=&#34;color:#50fa7b&#34;&gt;Load&lt;/span&gt;() &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;=&lt;/span&gt; trigger
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; gcTriggerTime:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// gcController.gcPercent &amp;lt; 0 è¡¨ç¤ºä¸è¿›è¡ŒGC&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; gcController.gcPercent.&lt;span style=&#34;color:#50fa7b&#34;&gt;Load&lt;/span&gt;() &amp;lt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// ä¸Šæ¬¡gcæ—¶é—´&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		lastgc &lt;span style=&#34;color:#ff79c6&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;int64&lt;/span&gt;(atomic.&lt;span style=&#34;color:#50fa7b&#34;&gt;Load64&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;memstats.last_gc_nanotime))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; lastgc &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; t.now&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;lastgc &amp;gt; forcegcperiod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; gcTriggerCycle:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#6272a4&#34;&gt;// t.n &amp;gt; work.cycles, but accounting for wraparound.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;int32&lt;/span&gt;(t.n&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;work.cycles.&lt;span style=&#34;color:#50fa7b&#34;&gt;Load&lt;/span&gt;()) &amp;gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å®šæ—¶è§¦å‘gc&#34;&gt;å®šæ—¶è§¦å‘GC&lt;/h3&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html lang=&#34;en&#34;&gt;

&lt;head&gt;
    &lt;style type=&#34;text/css&#34;&gt;
        #chart {
            padding-bottom: 66%;
            position: relative;
            display: block;
            width: 100%;
            border-bottom: 5px solid;
        }

        #chart iframe {
            position: absolute;
            top: 0;
            left: 0
        }
    &lt;/style&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id=&#34;chart&#34;&gt;
        &lt;iframe id=&#34;embed_dom&#34; width=100% height=100%  name=&#34;embed_dom&#34; frameborder=&#34;0&#34; src=&#34;https://viewer.diagrams.net/?tags=%7B%7D&amp;amp;highlight=0000ff&amp;amp;edit=_blank&amp;amp;layers=1&amp;amp;nav=1&amp;amp;title=golang-%E5%AE%9A%E6%97%B6gc%E8%A7%A6%E5%8F%91%E8%B7%AF%E5%BE%84.drawio#R7Zhbl5owEMc%2FjY%2FbI0G5vNa19qHtOXvsZX2MMEB2A2NDUOmnb5CwQHHV9qirnj7J%2FDO5zeQ3AXvmKF5PBF1En9EH3iN9f90z73uEGGRgqJ9CyUvFce1SCAXztVMtTNkv0GJfqxnzIW05SkQu2aItepgk4MmWRoXAVdstQN6edUFD6AhTj%2FKu%2BoP5MtK7IHatfwQWRtXMhuWWLTGtnPVO0oj6uGpI5rhnjgSiLJ%2Fi9Qh4EbwqLmW%2FD6%2B0vixMQCIP6XD38O0L%2ByoI2N9n9KfxkE2EdWfqtcm82jD4av%2FaRCEjDDGhfFyr7wVmiQ%2FFqH1l1T6fEBdKNJT4BFLmOpk0k6ikSMZct8KaycfG86wY6t1QW%2FdrPfLGyCsjkSJ%2FbBqNXoVZd9tYVb8AE6kXUoS8tPX2toRQSylmwoMdcauOIhUhyB1%2BpPQrgtqYQCdoAhiDWqxyEMCpZMv2oaP67IYvfnV61YPO8F9kW4%2B7pDzTM7GEyc4RqBNcZGgVMQnTBd3EY6UobyezE2DG%2BQg5is1Ypk%2FBCTylp1LgMzRaLM%2BBeaBaXs3CEoSE9c646VZTQ5dXxUMzt6qRdbUUNWi1%2BqcKtNEJ6o1z9e8okQNRqm6EC2GJdFgKUG009CLgCxA3ABUx9lNl2OfEatCJeehN1cE5cQkbguMPtkXbIXPTso4Tbcu9sBpm%2Fy9hh5aw4YElzLqoCjbs0BRTlpwUpSAAy9tauHzbnff7J3kbIPYbk%2BReC0nHI8I6kAjnooiwOkSkeRrjLTDx52X%2B5lAYV%2FjpWV8ps2qMs9wvznW%2BIjsdnFjyBJ4MOUtP%2B8p2pnvG2c%2BUQc4KFbkWqI4HR3Xo99IxuCg4qmU3P2ZQ7f%2F5pGCc58tx4JztW0aZ9V%2Bom7bGH9Hm%2BDc%3D&#34;&gt;&lt;/iframe&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
&lt;br&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;æ–¹æ³•&lt;/strong&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;æ–‡ä»¶&lt;/strong&gt;&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;init&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/proc.go&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;å¼€å¯ä¸€ä¸ª forcegchelper åç¨‹&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;forcegchelper&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/proc.go&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;å¾ªç¯é˜»å¡æŒ‚èµ·+å®šæ—¶è§¦å‘ gc&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;main&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/proc.go&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;è°ƒç”¨ sysmon æ–¹æ³•&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;sysmon&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/proc.go&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;å®šæ—¶å”¤é†’ forcegchelperï¼Œä»è€Œè§¦å‘ gc&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;gcTrigger.test&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mgc.go&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;æ ¡éªŒæ˜¯å¦æ»¡è¶³ gc è§¦å‘æ¡ä»¶&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;gcStart&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;runtime/mgc.go&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;æ ‡è®°å‡†å¤‡é˜¶æ®µä¸»æµç¨‹æ–¹æ³•&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;init + forcegchelper&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Golangäº’æ–¥é”-Mutex</title>
      <link>https://www.yici.xin/post/tech/golang%E4%BA%92%E6%96%A5%E9%94%81/</link>
      <pubDate>Tue, 27 Dec 2022 18:22:59 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golang%E4%BA%92%E6%96%A5%E9%94%81/</guid>
      <description>&lt;h2 id=&#34;äº’æ–¥é”ç»“æ„&#34;&gt;äº’æ–¥é”ç»“æ„&lt;/h2&gt;
&lt;hr&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// A Mutex is a mutual exclusion lock.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// The zero value for a Mutex is an unlocked mutex.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// A Mutex must not be copied after first use.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; Mutex &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	state &lt;span style=&#34;color:#8be9fd&#34;&gt;int32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	sema  &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Â &lt;code&gt;state&lt;/code&gt;è¡¨ç¤ºå½“å‰äº’æ–¥é”çš„çŠ¶æ€ï¼ŒÂ &lt;code&gt;sema&lt;/code&gt;æ˜¯ç”¨äºæ§åˆ¶é”çŠ¶æ€çš„ä¿¡å·é‡&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202212271823426.png&#34; alt=&#34;state&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œäº’æ–¥é”çš„æ‰€æœ‰çŠ¶æ€ä½éƒ½æ˜¯ 0ï¼Œ&lt;code&gt;int32&lt;/code&gt;Â ä¸­çš„ä¸åŒä½åˆ†åˆ«è¡¨ç¤ºäº†ä¸åŒçš„çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;mutexLocked&lt;/code&gt;Â â€” è¡¨ç¤ºäº’æ–¥é”çš„é”å®šçŠ¶æ€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;mutexWoken&lt;/code&gt;Â â€” å”¤é†’æ¨¡å¼ï¼Œæ­¤æ—¶é‡Šæ”¾é”çš„gä¸ä¼šå”¤é†’ä¼‘çœ çš„gï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;mutexStarving&lt;/code&gt;Â â€” å½“å‰çš„äº’æ–¥é”è¿›å…¥é¥¥é¥¿çŠ¶æ€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;waitersCount&lt;/code&gt;Â â€” å½“å‰äº’æ–¥é”ä¸Šç­‰å¾…çš„ Goroutine ä¸ªæ•°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼çš„åŒºåˆ«:&lt;/p&gt;
&lt;p&gt;åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œé”çš„ç­‰å¾…è€…ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè·å–é”ã€‚ä½†æ˜¯åˆšè¢«å”¤èµ·çš„ Goroutine ä¸æ–°åˆ›å»ºçš„ Goroutine ç«äº‰æ—¶ï¼Œå¤§æ¦‚ç‡ä¼šè·å–ä¸åˆ°é”ï¼Œä¸ºäº†å‡å°‘è¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œä¸€æ—¦ Goroutine è¶…è¿‡ 1ms æ²¡æœ‰è·å–åˆ°é”ï¼Œå®ƒå°±ä¼šå°†å½“å‰äº’æ–¥é”åˆ‡æ¢é¥¥é¥¿æ¨¡å¼ï¼Œé˜²æ­¢éƒ¨åˆ† Goroutine è¢«ã€é¥¿æ­»ã€ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>pprofä½¿ç”¨</title>
      <link>https://www.yici.xin/post/tech/pprof%E4%BD%BF%E7%94%A8/</link>
      <pubDate>Tue, 27 Dec 2022 18:18:12 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/pprof%E4%BD%BF%E7%94%A8/</guid>
      <description>&lt;p&gt;é¡¹ç›®åœ°å€:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/google/pprof&#34;&gt;https://github.com/google/pprof&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go install github.com/google/pprof@latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯profile&#34;&gt;ä»€ä¹ˆæ˜¯profile?&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;A Profile is a collection of stack traces showing the call sequences that led to instances of a particular event, such as allocation. Packages can create and maintain their own profiles; the most common use is for tracking resources that must be explicitly closed, such as files or network connections.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Each Profile has a unique name. A few profiles are predefined:&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;goroutine    &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; stack traces of all current goroutines
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;heap         &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; a sampling of all heap allocations
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;threadcreate &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; stack traces that led to the creation of new OS threads
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;block        &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; stack traces that led to blocking on synchronization primitives
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mutex        &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; stack traces of holders of contended mutexes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There are 7 places you can get profiles in the default webserver: the ones mentioned above&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Go Sync Pool</title>
      <link>https://www.yici.xin/post/tech/go-sync-pool/</link>
      <pubDate>Mon, 21 Nov 2022 17:05:22 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/go-sync-pool/</guid>
      <description>go sync pool</description>
    </item>
    
    <item>
      <title>Go channel</title>
      <link>https://www.yici.xin/post/tech/go-channel/</link>
      <pubDate>Mon, 21 Nov 2022 09:45:13 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/go-channel/</guid>
      <description>&lt;h2 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;channel çš„åº•å±‚æºç å’Œç›¸å…³å®ç°åœ¨/src/runtime/chan.goä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; hchan &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	qcount   &lt;span style=&#34;color:#8be9fd&#34;&gt;uint&lt;/span&gt;           &lt;span style=&#34;color:#6272a4&#34;&gt;// é˜Ÿåˆ—ä¸­æ‰€æœ‰æ•°æ®æ€»æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	dataqsiz &lt;span style=&#34;color:#8be9fd&#34;&gt;uint&lt;/span&gt;           &lt;span style=&#34;color:#6272a4&#34;&gt;// ç¯å½¢é˜Ÿåˆ—çš„ size&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	buf      unsafe.Pointer &lt;span style=&#34;color:#6272a4&#34;&gt;// æŒ‡å‘ dataqsiz é•¿åº¦çš„æ•°ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	elemsize &lt;span style=&#34;color:#8be9fd&#34;&gt;uint16&lt;/span&gt;         &lt;span style=&#34;color:#6272a4&#34;&gt;// å…ƒç´ å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	closed   &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	elemtype &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;_type         &lt;span style=&#34;color:#6272a4&#34;&gt;// å…ƒç´ ç±»å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	sendx    &lt;span style=&#34;color:#8be9fd&#34;&gt;uint&lt;/span&gt;           &lt;span style=&#34;color:#6272a4&#34;&gt;// å·²å‘é€çš„å…ƒç´ åœ¨ç¯å½¢é˜Ÿåˆ—ä¸­çš„ä½ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	recvx    &lt;span style=&#34;color:#8be9fd&#34;&gt;uint&lt;/span&gt;           &lt;span style=&#34;color:#6272a4&#34;&gt;// å·²æ¥æ”¶çš„å…ƒç´ åœ¨ç¯å½¢é˜Ÿåˆ—ä¸­çš„ä½ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	recvq    waitq          &lt;span style=&#34;color:#6272a4&#34;&gt;// æ¥æ”¶è€…çš„ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	sendq    waitq          &lt;span style=&#34;color:#6272a4&#34;&gt;// å‘é€è€…çš„ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// lock é”ä¿æŠ¤ hchan ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œä»¥åŠæ­¤é€šé“ä¸Šè¢«é˜»å¡çš„ sudogs ä¸­çš„å¤šä¸ªå­—æ®µã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#6272a4&#34;&gt;// æŒæœ‰ lock çš„æ—¶å€™ï¼Œç¦æ­¢æ›´æ”¹å¦ä¸€ä¸ª G çš„çŠ¶æ€ï¼ˆç‰¹åˆ«æ˜¯ä¸è¦ä½¿ G çŠ¶æ€å˜æˆreadyï¼‰ï¼Œ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// å› ä¸ºè¿™ä¼šå› ä¸ºå †æ ˆ shrinking è€Œå‘ç”Ÿæ­»é”ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	lock mutex
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211291714199.png&#34; alt=&#34;hchanæ•°æ®ç»“æ„&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;recvq å’Œ sendq æ˜¯ç­‰å¾…é˜Ÿåˆ—ï¼Œwaitq ç±»å‹æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼š&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>golang-mapä»‹ç»</title>
      <link>https://www.yici.xin/post/tech/golang-map%E4%BB%8B%E7%BB%8D/</link>
      <pubDate>Wed, 05 Jan 2022 23:38:06 +0800</pubDate>
      
      <guid>https://www.yici.xin/post/tech/golang-map%E4%BB%8B%E7%BB%8D/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸­ä½¿ç”¨çš„ go ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;p&gt;go version go1.17.2 darwin/amd64&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å†…å®¹æ¦‚è¿°&#34;&gt;å†…å®¹æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» golang ä¸­ç»å¸¸ç”¨åˆ°çš„ç»“æ„-mapï¼Œç®€ç§°å“ˆå¸Œè¡¨ã€å­—å…¸ã€‚ä»‹ç»å…¶ç»“æ„åŠè®¾è®¡æ€è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;map-åœ¨æºç ä¸­çš„ç»“æ„hmap&#34;&gt;map åœ¨æºç ä¸­çš„ç»“æ„â€”â€”hmap&lt;/h2&gt;
&lt;p&gt;Go è¯­è¨€é‡‡ç”¨çš„æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯å“ˆå¸ŒæŸ¥æ‰¾è¡¨ï¼Œä½¿ç”¨é“¾è¡¨è§£å†³å“ˆå¸Œå†²çªã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æºç ä¸­&lt;code&gt;$GOROOT/src/runtime/map.go&lt;/code&gt;ï¼Œmap çš„æ ¸å¿ƒç»“æ„ä½“æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// A header for a Go map.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;type&lt;/span&gt; hmap &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    count     &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;// mapä¸­çš„å…ƒç´ æ•°é‡ï¼Œå³len(map)æ—¶çš„è¿”å›å€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    flags     &lt;span style=&#34;color:#8be9fd&#34;&gt;uint8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    B         &lt;span style=&#34;color:#8be9fd&#34;&gt;uint8&lt;/span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;// bucketsçš„ä»¥2ä¸ºåº•çš„å¯¹æ•°, å³2^B=buckets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    noverflow &lt;span style=&#34;color:#8be9fd&#34;&gt;uint16&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;// æº¢å‡ºæ¡¶çš„è¿‘ä¼¼æ•°; see incrnoverflow for details&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    hash0     &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;// å“ˆå¸Œç§å­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    buckets    unsafe.Pointer &lt;span style=&#34;color:#6272a4&#34;&gt;// 2^Bä¸ªbucketçš„æ•°ç»„ï¼Œmay be nil if count==0.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    oldbuckets unsafe.Pointer &lt;span style=&#34;color:#6272a4&#34;&gt;// å“ˆå¸Œåœ¨æ‰©å®¹æ—¶ç”¨äºä¿å­˜ä¹‹å‰ buckets çš„å­—æ®µï¼Œå®ƒçš„å¤§å°æ˜¯å½“å‰ buckets çš„ä¸€åŠï¼›&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    nevacuate  &lt;span style=&#34;color:#8be9fd&#34;&gt;uintptr&lt;/span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// progress counter for evacuation (buckets less than this have been evacuated)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    extra &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;mapextra &lt;span style=&#34;color:#6272a4&#34;&gt;// optional fields&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸Šé¢æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ ¸å¿ƒæ˜¯&lt;code&gt;buckets&lt;/code&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæœ€ç»ˆæŒ‡å‘äº†&lt;code&gt;bmap&lt;/code&gt;ç»“æ„ä½“æ•°ç»„&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
