<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css integrity=sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js integrity=sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js integrity=sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl crossorigin=anonymous></script><title>Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾ | yicixin's blog</title><meta name=keywords content="rust,ç¿»è¯‘"><meta name=description content="åŸæ–‡é“¾æ¥ğŸ”—
Defining an Enum å®šä¹‰æšä¸¾
Where structs give you a way of grouping together related fields and data, like aÂ RectangleÂ with itsÂ widthÂ andÂ height, enums give you a way of saying a value is one of a possible set of values. For example, we may want to say thatÂ RectangleÂ is one of a set of possible shapes that also includesÂ CircleÂ andÂ Triangle. To do this, Rust allows us to encode these possibilities as an enum."><meta name=author content="å£¹æ¬¡å¿ƒ"><link rel=canonical href=https://www.yici.xin/post/read/rust%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1-%E6%9E%9A%E4%B8%BE/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.00d594ac5404702263b7df2f247aae4053818963176b093f9b95a1fc7e4e0b42.css integrity="sha256-ANWUrFQEcCJjt98vJHquQFOBiWMXawk/m5Wh/H5OC0I=" rel="preload stylesheet" as=style><link rel=icon href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=icon type=image/png sizes=16x16 href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=icon type=image/png sizes=32x32 href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=apple-touch-icon href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=mask-icon href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾"><meta property="og:description" content="åŸæ–‡é“¾æ¥ğŸ”—
Defining an Enum å®šä¹‰æšä¸¾
Where structs give you a way of grouping together related fields and data, like aÂ RectangleÂ with itsÂ widthÂ andÂ height, enums give you a way of saying a value is one of a possible set of values. For example, we may want to say thatÂ RectangleÂ is one of a set of possible shapes that also includesÂ CircleÂ andÂ Triangle. To do this, Rust allows us to encode these possibilities as an enum."><meta property="og:type" content="article"><meta property="og:url" content="https://www.yici.xin/post/read/rust%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1-%E6%9E%9A%E4%B8%BE/"><meta property="og:image" content="https://www.yici.xin/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-12-28T23:09:59+08:00"><meta property="article:modified_time" content="2022-12-28T23:09:59+08:00"><meta property="og:site_name" content="yicixin's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.yici.xin/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾"><meta name=twitter:description content="åŸæ–‡é“¾æ¥ğŸ”—
Defining an Enum å®šä¹‰æšä¸¾
Where structs give you a way of grouping together related fields and data, like aÂ RectangleÂ with itsÂ widthÂ andÂ height, enums give you a way of saying a value is one of a possible set of values. For example, we may want to say thatÂ RectangleÂ is one of a set of possible shapes that also includesÂ CircleÂ andÂ Triangle. To do this, Rust allows us to encode these possibilities as an enum."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.yici.xin/post/"},{"@type":"ListItem","position":2,"name":"ğŸ“–é˜…è¯»","item":"https://www.yici.xin/post/read/"},{"@type":"ListItem","position":3,"name":"Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾","item":"https://www.yici.xin/post/read/rust%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1-%E6%9E%9A%E4%B8%BE/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾","name":"Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾","description":"åŸæ–‡é“¾æ¥ğŸ”—\nDefining an Enum å®šä¹‰æšä¸¾\nWhere structs give you a way of grouping together related fields and data, like aÂ RectangleÂ with itsÂ widthÂ andÂ height, enums give you a way of saying a value is one of a possible set of values. For example, we may want to say thatÂ RectangleÂ is one of a set of possible shapes that also includesÂ CircleÂ andÂ Triangle. To do this, Rust allows us to encode these possibilities as an enum.","keywords":["rust","ç¿»è¯‘"],"articleBody":" åŸæ–‡é“¾æ¥ğŸ”—\nDefining an Enum å®šä¹‰æšä¸¾\nWhere structs give you a way of grouping together related fields and data, like aÂ RectangleÂ with itsÂ widthÂ andÂ height, enums give you a way of saying a value is one of a possible set of values. For example, we may want to say thatÂ RectangleÂ is one of a set of possible shapes that also includesÂ CircleÂ andÂ Triangle. To do this, Rust allows us to encode these possibilities as an enum.\nç»“æ„ä½“æä¾›ç»™æˆ‘ä»¬å°†ç›¸è”ç³»çš„å­—æ®µå’Œæ•°æ®èšåˆåœ¨ä¸€èµ·çš„æ‰‹æ®µï¼Œåƒæ˜¯æœ‰widthå’Œheightä¸¤ä¸ªå­—æ®µçš„Rectangleç»“æ„ï¼Œæšä¸¾æ‰€æä¾›çš„èƒ½åŠ›æ˜¯ï¼Œè¡¨ç¤ºä¸€ä¸ªå€¼æ˜¯ä¸€ç»„å¯èƒ½å€¼ä¸­çš„ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¡¨ç¤ºRectangleæ˜¯ä¸€ç»„å½¢çŠ¶ä¸­çš„ä¸€ä¸ªï¼Œè¿™ç»„å½¢çŠ¶å¯èƒ½è¿˜åŒ…æ‹¬äº†åœ†å½¢ã€ä¸‰è§’å½¢ã€‚åœ¨Rustä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å¯èƒ½çš„å€¼ç¼–ç æˆä¸€ä¸ªæšä¸¾ã€‚\nLetâ€™s look at a situation we might want to express in code and see why enums are useful and more appropriate than structs in this case. Say we need to work with IP addresses. Currently, two major standards are used for IP addresses: version four and version six. Because these are the only possibilities for an IP address that our program will come across, we canÂ enumerateÂ all possible variants, which is where enumeration gets its name.\nè®©æˆ‘ä»¬çœ‹ä¸€ç§æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­è¡¨è¾¾çš„æƒ…å†µå¹¶ä¸”æ¥è§£é‡Šä¸ºä»€ä¹ˆæšä¸¾æ˜¯æœ‰ç”¨çš„ï¼Œä¸”åœ¨è¿™ç§æƒ…å†µä¸‹æ¯”ç»“æ„ä½“æ˜¯æ›´é€‚åˆçš„ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ä½¿ç”¨IPåœ°å€ã€‚ç›®å‰ï¼ŒIPåœ°å€æœ‰ä¸¤ç§ä¸»æµæ ‡å‡†ï¼ŒV4å’ŒV6.åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œè¿™äº›æ˜¯å”¯ä¸€å¯èƒ½é‡åˆ°çš„IPåœ°å€å½¢å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æšä¸¾æ‰€æœ‰çš„å¯èƒ½ï¼Œè¿™å°±æ˜¯æšä¸¾åç§°çš„æ¥æºã€‚\nAny IP address can be either a version four or a version six address, but not both at the same time. That property of IP addresses makes the enum data structure appropriate, because an enum value can only be one of its variants. Both version four and version six addresses are still fundamentally IP addresses, so they should be treated as the same type when the code is handling situations that apply to any kind of IP address.\nä»»ä½•IPåœ°å€éƒ½å¯ä»¥æ˜¯V4æˆ–è€…V6ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶æ˜¯ä¸¤è€…ã€‚IPåœ°å€çš„è¿™ä¸ªå±æ€§ä½¿å¾—æšä¸¾æ˜¯åˆé€‚çš„ï¼Œå› ä¸ºæšä¸¾æˆå‘˜åªèƒ½æ˜¯å®ƒæ‰€æœ‰å¯èƒ½ä¸­çš„ä¸€ä¸ªã€‚V4å’ŒV6åœ°å€éƒ½æ˜¯IPåœ°å€ï¼Œæ‰€ä»¥å½“ä»£ç å¤„ç†é€‚ç”¨äºä»»ä½•IPåœ°å€çš„æƒ…å†µæ—¶ï¼Œå®ƒä»¬åº”è¯¥è¢«å½“åšåŒä¸€ç§ç±»å‹ã€‚\nWe can express this concept in code by defining anÂ IpAddrKindÂ enumeration and listing the possible kinds an IP address can be,Â V4Â andÂ V6. These are the variants of the enum:\nenum IpAddrKind { V4, V6, } IpAddrKindÂ is now a custom data type that we can use elsewhere in our code. æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­è¡¨ç¤ºè¿™ä¸ªæ¦‚å¿µï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªIpAddrKindæšä¸¾ï¼Œå¹¶ä¸”åˆ—å‡ºIPåœ°å€æ‰€æœ‰çš„ç±»å‹ã€‚\nIpAddrKindÂ ç°åœ¨æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚\nEnum Values We can create instances of each of the two variants ofÂ IpAddrKindÂ like this:\nlet four = IpAddrKind::V4; let six = IpAddrKind::V6; æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åˆ›å»ºè¿™ä¸¤ä¸ªæšä¸¾æˆå‘˜çš„æ¯ä¸ªå®ä¾‹ã€‚\nNote that the variants of the enum are namespaced under its identifier, and we use a double colon to separate the two. This is useful because now both valuesÂ IpAddrKind::V4Â andÂ IpAddrKind::V6Â are of the same type:Â IpAddrKind. We can then, for instance, define a function that takes anyÂ IpAddrKind:\nfn route(ip_kind: IpAddrKind) {} And we can call this function with either variant:\nroute(IpAddrKind::V4); route(IpAddrKind::V6); æ³¨æ„ï¼Œæšä¸¾çš„æˆå‘˜ä½äºå…¶æšä¸¾æ ‡è¯†ç¬¦çš„å‘½åç©ºé—´ä¸‹ï¼Œä½¿ç”¨ä¸¤ä¸ªå†’å·åˆ†éš”ï¼Œè¿™ä¹ˆè®¾è®¡çš„ç›Šå¤„æ˜¯ç°åœ¨Â IpAddrKind::V4Â å’ŒÂ IpAddrKind::V6Â éƒ½æ˜¯Â IpAddrKindÂ ç±»å‹çš„ã€‚ä¾‹å¦‚ï¼Œæ¥ç€å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è·å–ä»»ä½•Â IpAddrKindï¼š\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä¸€è¯¥æšä¸¾çš„æˆå‘˜æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š\nUsing enums has even more advantages. Thinking more about our IP address type, at the moment we donâ€™t have a way to store the actual IP addressÂ data; we only know whatÂ kindÂ it is. Given that you just learned about structs in Chapter 5, you might be tempted to tackle this problem with structs as shown in Listing 6-1.\nä½¿ç”¨æšä¸¾è¿˜æœ‰æ›´å¤šä¼˜ç‚¹ï¼Œè¿›ä¸€æ­¥è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬çš„ IP åœ°å€ç±»å‹ï¼Œç›®å‰æ²¡æœ‰ä¸€ä¸ªå­˜å‚¨å®é™… IP åœ°å€Â æ•°æ®Â çš„æ–¹æ³•ï¼›åªçŸ¥é“å®ƒæ˜¯ä»€ä¹ˆÂ ç±»å‹Â çš„ã€‚è€ƒè™‘åˆ°å·²ç»åœ¨ç¬¬ 5 ç« å­¦ä¹ è¿‡ç»“æ„ä½“äº†ï¼Œä½ å¯èƒ½ä¼šåƒç¤ºä¾‹ 6-1 é‚£æ ·å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š\nfn main() { enum IpAddrKind { V4, V6, } struct IpAddr { kind: IpAddrKind, address: String, } let home = IpAddr { kind: IpAddrKind::V4, address: String::from(\"127.0.0.1\"), }; let loopback = IpAddr { kind: IpAddrKind::V6, address: String::from(\"::1\"), }; } Listing 6-1: Storing the data andÂ IpAddrKindÂ variant of an IP address using aÂ struct ç¤ºä¾‹ 6-1ï¼šå°† IP åœ°å€çš„æ•°æ®å’ŒÂ IpAddrKindÂ æˆå‘˜å­˜å‚¨åœ¨ä¸€ä¸ªÂ structÂ ä¸­\nHere, weâ€™ve defined a structÂ IpAddrÂ that has two fields: aÂ kindÂ field that is of typeÂ IpAddrKindÂ (the enum we defined previously) and anÂ addressÂ field of typeÂ String. We have two instances of this struct. The first isÂ home, and it has the valueÂ IpAddrKind::V4Â as itsÂ kindÂ with associated address data ofÂ 127.0.0.1. The second instance isÂ loopback. It has the other variant ofÂ IpAddrKindÂ as itsÂ kindÂ value,Â V6, and has addressÂ ::1Â associated with it. Weâ€™ve used a struct to bundle theÂ kindÂ andÂ addressÂ values together, so now the variant is associated with the value.\nè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­—æ®µçš„ç»“æ„ä½“ï¼ŒÂ IpAddrKindï¼ˆä¹‹å‰å®šä¹‰çš„æšä¸¾ï¼‰ç±»å‹çš„Â kindÂ å­—æ®µå’ŒÂ StringÂ ç±»å‹Â addressÂ å­—æ®µã€‚æˆ‘ä»¬æœ‰è¿™ä¸ªç»“æ„ä½“çš„ä¸¤ä¸ªå®ä¾‹ã€‚ç¬¬ä¸€ä¸ªï¼Œhomeï¼Œå®ƒçš„Â kindÂ çš„å€¼æ˜¯Â IpAddrKind::V4Â ï¼Œä¸ä¹‹ç›¸å…³è”çš„åœ°å€æ•°æ®æ˜¯Â 127.0.0.1ã€‚ç¬¬äºŒä¸ªå®ä¾‹ï¼Œloopbackï¼ŒkindÂ çš„å€¼æ˜¯Â IpAddrKindÂ çš„å¦ä¸€ä¸ªæˆå‘˜ï¼ŒV6ï¼Œå…³è”çš„åœ°å€æ˜¯Â ::1ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç»“æ„ä½“æ¥å°†Â kindÂ å’ŒÂ addressÂ æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç°åœ¨æšä¸¾æˆå‘˜å°±ä¸å€¼ç›¸å…³è”äº†ã€‚\nHowever, representing the same concept using just an enum is more concise: rather than an enum inside a struct, we can put data directly into each enum variant. This new definition of theÂ IpAddrÂ enum says that bothÂ V4Â andÂ V6Â variants will have associatedÂ StringÂ values:\nenum IpAddr { V4(String), V6(String), } let home = IpAddr::V4(String::from(\"127.0.0.1\")); let loopback = IpAddr::V6(String::from(\"::1\")); ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æšä¸¾æ¥æ›´ç®€æ´åœ°è¡¨è¾¾ç›¸åŒçš„æ¦‚å¿µï¼Œä¸æ˜¯å°†æšä¸¾ä½œä¸ºç»“æ„ä½“çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜ã€‚è¿™é‡ŒIpAddrÂ æšä¸¾çš„æ–°å®šä¹‰ï¼ŒÂ V4Â å’ŒÂ V6Â æˆå‘˜éƒ½å…³è”äº†Â Stringå€¼ï¼š\nWe attach data to each variant of the enum directly, so there is no need for an extra struct. Here itâ€™s also easier to see another detail of how enums work: the name of each enum variant that we define also becomes a function that constructs an instance of the enum. That is,Â IpAddr::V4()Â is a function call that takes aÂ StringÂ argument and returns an instance of theÂ IpAddrÂ type. We automatically get this constructor function defined as a result of defining the enum.\næˆ‘ä»¬å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„ç»“æ„ä½“ã€‚è¿™é‡Œä¹Ÿèƒ½å¤Ÿçœ‹åˆ°æšä¸¾ç”¨æ³•çš„å¦ä¸€ä¸ªç»†èŠ‚ï¼Œæˆ‘ä»¬æ‰€å®šä¹‰çš„æ¯ä¸€æšä¸¾æˆå‘˜çš„åç§°åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒIpAddr::V4()æ˜¯ä¸€ä¸ªä»¥Â StringÂ ä½œä¸ºå‚æ•°ï¼Œä¸”è¿”å›ä¸€ä¸ªIpAddrç±»å‹å®ä¾‹çš„å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æ˜¯æˆ‘ä»¬åœ¨å®šä¹‰æšä¸¾æ—¶å°±è‡ªåŠ¨å¾—åˆ°çš„ä¸€ä¸ªç»“æœã€‚\nThereâ€™s another advantage to using an enum rather than a struct: each variant can have different types and amounts of associated data. Version four type IP addresses will always have four numeric components that will have values between 0 and 255. If we wanted to storeÂ V4Â addresses as fourÂ u8Â values but still expressÂ V6Â addresses as oneÂ StringÂ value, we wouldnâ€™t be able to with a struct. Enums handle this case with ease:\nfn main() { enum IpAddr { V4(u8, u8, u8, u8), V6(String), } let home = IpAddr::V4(127, 0, 0, 1); let loopback = IpAddr::V6(String::from(\"::1\")); } è¿˜æœ‰å¦ä¸€ä¸ªæšä¸¾æ¯”ç»“æ„ä½“æ›´åˆé€‚çš„ä¾‹å­ï¼Œæ¯ä¸ªæšä¸¾æˆå‘˜å¯ä»¥æœ‰ä¸åŒçš„ç±»å‹å’Œæ•°æ®æ•°é‡ï¼ŒIPV4åœ°å€çš„æ ¼å¼æ€»æ˜¯ç”±å››ä¸ª0-255ä¹‹é—´çš„æ•°å­—ç»„æˆã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠV4åœ°å€ä»¥å››ä¸ªu8ç±»å‹å€¼è¿›è¡Œå­˜å‚¨ä½†åŒæ—¶ä»ç”¨Stringç±»å‹è¡¨ç¤ºV6åœ°å€ï¼Œä½¿ç”¨ç»“æ„ä½“æ˜¯åšä¸åˆ°çš„ã€‚æšä¸¾å¯ä»¥å¾ˆç®€å•åœ°å¤„ç†è¿™ä¸ªæƒ…å†µ:\nWeâ€™ve shown several different ways to define data structures to store version four and version six IP addresses. However, as it turns out, wanting to store IP addresses and encode which kind they are is so common thatÂ the standard library has a definition we can use!Â Letâ€™s look at how the standard library definesÂ IpAddr: it has the exact enum and variants that weâ€™ve defined and used, but it embeds the address data inside the variants in the form of two different structs, which are defined differently for each variant:\nstruct Ipv4Addr { // --snip-- } struct Ipv6Addr { // --snip-- } enum IpAddr { V4(Ipv4Addr), V6(Ipv6Addr), } æˆ‘ä»¬å·²ç»åˆ—ä¸¾äº†å¥½å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰ç”¨äºå­˜å‚¨V4å’ŒV6IPåœ°å€çš„æ•°æ®ç»“æ„ï¼Œç„¶è€Œï¼Œäº‹å®è¯æ˜ï¼Œå­˜å‚¨IPåœ°å€å’Œç¼–ç å®ƒä»¬çš„ç§ç±»å®åœ¨æ˜¯å¤ªå¸¸è§äº†ï¼Œä»¥è‡³äºæ ‡å‡†åº“å·²ç»åŒ…å«äº†æˆ‘ä»¬èƒ½ç”¨çš„å®šä¹‰ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ ‡å‡†åº“å¦‚ä½•å®šä¹‰IpAddr: å®ƒçš„æšä¸¾å’Œæˆå‘˜å’Œæˆ‘ä»¬æ‰€å®šä¹‰åŠä½¿ç”¨çš„æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡å®ƒç”¨ä¸¤ä¸ªä¸åŒçš„ç»“æ„çš„å½¢å¼å°†åœ°å€æ•°æ®åµŒå…¥åˆ°æšä¸¾æˆå‘˜ä¸­ï¼Œæ¯ä¸ªæˆå‘˜çš„ç»“æ„ä½“å®šä¹‰æ˜¯ä¸åŒçš„ï¼š\nThis code illustrates that you can put any kind of data inside an enum variant: strings, numeric types, or structs, for example. You can even include another enum! Also, standard library types are often not much more complicated than what you might come up with.\nè¿™äº›ä»£ç è¯´æ˜ä½ å¯ä»¥æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®åˆ°æšä¸¾æˆå‘˜ä¸­ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ç±»å‹å’Œç»“æ„ä½“ï¼Œç”šè‡³ä½ å¯ä»¥æ”¾å¦ä¸€ä¸ªæšä¸¾ï¼å¹¶ä¸”ï¼Œæ ‡å‡†åº“çš„ç±»å‹é€šå¸¸ä¸ä¼šæ¯”ä½ èƒ½ç¢°åˆ°çš„å¤æ‚å¤šå°‘ã€‚\nNote that even though the standard library contains a definition forÂ IpAddr, we can still create and use our own definition without conflict because we havenâ€™t brought the standard libraryâ€™s definition into our scope. Weâ€™ll talk more about bringing types into scope in Chapter 7.\næ³¨æ„ï¼Œå³ä½¿æ ‡å‡†åº“å·²ç»åŒ…å«äº†å¯¹IpAddrçš„å®šä¹‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä»å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å®šä¹‰ï¼Œä¸ä¼šæœ‰å†²çªï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æŠŠæ ‡å‡†åº“å®šä¹‰å¼•å…¥æˆ‘ä»¬çš„ä½œç”¨åŸŸæ¥ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ä¸ƒç« è°ˆè®ºå¦‚ä½•åšåˆ°è¿™ä¸ªã€‚\nLetâ€™s look at another example of an enum in Listing 6-2: this one has a wide variety of types embedded in its variants.\nè®©æˆ‘ä»¬æ¥çœ‹6-2çš„ä¾‹å­ä¸­çš„å¦ä¸€ä¸ªæšä¸¾ï¼šè¿™ä¸ªæšä¸¾çš„æˆå‘˜åµŒå…¥äº†å„ç§å„æ ·çš„ç±»å‹ã€‚\nenum Message { Quit, Move { x: i32, y: i32 }, Write(String), ChangeColor(i32, i32, i32), } Listing 6-2: AÂ MessageÂ enum whose variants each store different amounts and types of values Listing 6-2: ä¸€ä¸ªåä¸ºMessageçš„æšä¸¾ï¼Œå…¶æ¯ä¸ªæˆå‘˜éƒ½å­˜å‚¨äº†ä¸åŒæ•°é‡å’Œç±»å‹çš„å€¼\nThis enum has four variants with different types:\nQuitÂ has no data associated with it at all. MoveÂ has named fields like a struct does. WriteÂ includes a singleÂ String. ChangeColorÂ includes threeÂ i32Â values. è¿™ä¸ªæšä¸¾æœ‰å››ä¸ªä¸åŒç±»å‹çš„æˆå‘˜ï¼š\nQuitï¼Œæ²¡æœ‰å…³è”æ•°æ® Moveï¼Œæœ‰å’Œç»“æ„ä½“ä¸€æ ·çš„å‘½åå­—æ®µ Writeï¼ŒåŒ…å«äº†å•ç‹¬çš„ä¸€ä¸ªString ChangeColorï¼ŒåŒ…å«äº†ä¸‰ä¸ªi32å€¼ Defining an enum with variants such as the ones in Listing 6-2 is similar to defining different kinds of struct definitions, except the enum doesnâ€™t use theÂ structÂ keyword and all the variants are grouped together under theÂ MessageÂ type. The following structs could hold the same data that the preceding enum variants hold:\nstruct QuitMessage; // ç±»å•å…ƒç»“æ„ä½“ struct MoveMessage { x: i32, y: i32, } struct WriteMessage(String); // å…ƒç»„ç»“æ„ä½“ struct ChangeColorMessage(i32, i32, i32); // å…ƒç»„ç»“æ„ä½“ å®šä¹‰ä¸€ä¸ªå¦‚ç¤ºä¾‹ 6-2 ä¸­æ‰€ç¤ºé‚£æ ·çš„æœ‰å…³è”å€¼çš„æšä¸¾çš„æ–¹å¼å’Œå®šä¹‰å¤šä¸ªä¸åŒç±»å‹çš„ç»“æ„ä½“çš„æ–¹å¼å¾ˆç›¸åƒï¼Œé™¤äº†æšä¸¾ä¸ä½¿ç”¨Â structÂ å…³é”®å­—ä»¥åŠå…¶æ‰€æœ‰æˆå‘˜éƒ½è¢«ç»„åˆåœ¨ä¸€èµ·ä½äºÂ MessageÂ ç±»å‹ä¸‹ã€‚å¦‚ä¸‹è¿™äº›ç»“æ„ä½“å¯ä»¥åŒ…å«ä¸ä¹‹å‰æšä¸¾æˆå‘˜ä¸­ç›¸åŒçš„æ•°æ®ï¼š\nBut if we used the different structs, which each have their own type, we couldnâ€™t as easily define a function to take any of these kinds of messages as we could with theÂ MessageÂ enum defined in Listing 6-2, which is a single type.\nä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“ï¼Œç”±äºå®ƒä»¬éƒ½æœ‰ä¸åŒçš„ç±»å‹ï¼Œæˆ‘ä»¬å°†ä¸èƒ½åƒä½¿ç”¨ç¤ºä¾‹ 6-2 ä¸­å®šä¹‰çš„Â MessageÂ æšä¸¾é‚£æ ·ï¼Œè½»æ˜“çš„å®šä¹‰ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†è¿™äº›ä¸åŒç±»å‹çš„ç»“æ„ä½“çš„å‡½æ•°ï¼Œå› ä¸ºæšä¸¾æ˜¯å•ç‹¬ä¸€ä¸ªç±»å‹ã€‚\nThere is one more similarity between enums and structs: just as weâ€™re able to define methods on structs usingÂ impl, weâ€™re also able to define methods on enums. Hereâ€™s a method namedÂ callÂ that we could define on ourÂ MessageÂ enum:\nfn main() { #[derive(Debug)] enum Message { Quit, Move { x: i32, y: i32 }, Write(String), ChangeColor(i32, i32, i32), } impl Message { fn call(\u0026self) { println!(\"{:?}\", self); // Write(\"hello\") } } let m = Message::Write(String::from(\"hello\")); m.call(); } æšä¸¾å’Œç»“æ„ä½“è¿˜æœ‰å¦ä¸€ä¸ªç›¸ä¼¼ç‚¹ï¼šå°±åƒå¯ä»¥ä½¿ç”¨Â implÂ æ¥ä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•é‚£æ ·ï¼Œä¹Ÿå¯ä»¥åœ¨æšä¸¾ä¸Šå®šä¹‰æ–¹æ³•ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨Â MessageÂ æšä¸¾ä¸Šå®šä¹‰äº†ä¸€ä¸ªå«åšÂ callÂ çš„æ–¹æ³•ï¼š\nThe body of the method would useÂ selfÂ to get the value that we called the method on. In this example, weâ€™ve created a variableÂ mÂ that has the valueÂ Message::Write(String::from(\"hello\")), and that is whatÂ selfÂ will be in the body of theÂ callÂ method whenÂ m.call()Â runs.\nåœ¨æ–¹æ³•ä½“ä¸­ä½¿ç”¨äº†Â selfÂ æ¥è·å–æ–¹æ³•çš„è°ƒç”¨è€…ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå€¼ä¸ºÂ Message::Write(String::from(\"hello\"))Â çš„å˜é‡Â mï¼Œmå°±æ˜¯å½“Â m.call()Â è¿è¡Œæ—¶Â callÂ æ–¹æ³•ä¸­çš„Â selfÂ çš„å€¼ã€‚\n","wordCount":"1483","inLanguage":"zh","datePublished":"2022-12-28T23:09:59+08:00","dateModified":"2022-12-28T23:09:59+08:00","author":[{"@type":"Person","name":"å£¹æ¬¡å¿ƒ"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yici.xin/post/read/rust%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1-%E6%9E%9A%E4%B8%BE/"},"publisher":{"@type":"Organization","name":"yicixin's blog","logo":{"@type":"ImageObject","url":"https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.yici.xin/ accesskey=h title="ğŸ‘€ (Alt + H)">ğŸ‘€</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.yici.xin/tags/ title=æ ‡ç­¾ğŸ·ï¸><span>æ ‡ç­¾ğŸ·ï¸</span></a></li><li><a href=https://www.yici.xin/archives/ title=å½’æ¡£ğŸ•°ï¸><span>å½’æ¡£ğŸ•°ï¸</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.yici.xin/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.yici.xin/post/>Posts</a>&nbsp;Â»&nbsp;<a href=https://www.yici.xin/post/read/>ğŸ“–é˜…è¯»</a></div><h1 class=post-title>Rustç¨‹åºè®¾è®¡â€”â€”æšä¸¾</h1><div class=post-meta><span title='2022-12-28 23:09:59 +0800 +0800'>2022-12-28</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;1483 å­—&nbsp;Â·&nbsp;å£¹æ¬¡å¿ƒ&nbsp;|&nbsp;<a href=https://github.com/yicixin/blog/blob/main/content/post/read/rust%e7%a8%8b%e5%ba%8f%e8%ae%be%e8%ae%a1-%e6%9e%9a%e4%b8%be.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><blockquote><p><a href=https://doc.rust-lang.org/stable/book/ch06-01-defining-an-enum.html>åŸæ–‡é“¾æ¥ğŸ”—</a></p></blockquote><h2 id=defining-an-enum>Defining an Enum<a hidden class=anchor aria-hidden=true href=#defining-an-enum>#</a></h2><p>å®šä¹‰æšä¸¾</p><p>Where structs give you a way of grouping together related fields and data, like aÂ <code>Rectangle</code>Â with itsÂ <code>width</code>Â andÂ <code>height</code>, enums give you a way of saying a value is one of a possible set of values. For example, we may want to say thatÂ <code>Rectangle</code>Â is one of a set of possible shapes that also includesÂ <code>Circle</code>Â andÂ <code>Triangle</code>. To do this, Rust allows us to encode these possibilities as an enum.</p><p>ç»“æ„ä½“æä¾›ç»™æˆ‘ä»¬å°†ç›¸è”ç³»çš„å­—æ®µå’Œæ•°æ®èšåˆåœ¨ä¸€èµ·çš„æ‰‹æ®µï¼Œåƒæ˜¯æœ‰<code>width</code>å’Œ<code>height</code>ä¸¤ä¸ªå­—æ®µçš„<code>Rectangle</code>ç»“æ„ï¼Œæšä¸¾æ‰€æä¾›çš„èƒ½åŠ›æ˜¯ï¼Œè¡¨ç¤ºä¸€ä¸ªå€¼æ˜¯ä¸€ç»„å¯èƒ½å€¼ä¸­çš„ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¡¨ç¤º<code>Rectangle</code>æ˜¯ä¸€ç»„å½¢çŠ¶ä¸­çš„ä¸€ä¸ªï¼Œè¿™ç»„å½¢çŠ¶å¯èƒ½è¿˜åŒ…æ‹¬äº†åœ†å½¢ã€ä¸‰è§’å½¢ã€‚åœ¨Rustä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å¯èƒ½çš„å€¼ç¼–ç æˆä¸€ä¸ªæšä¸¾ã€‚</p><p>Letâ€™s look at a situation we might want to express in code and see why enums are useful and more appropriate than structs in this case. Say we need to work with IP addresses. Currently, two major standards are used for IP addresses: version four and version six. Because these are the only possibilities for an IP address that our program will come across, we canÂ <em>enumerate</em>Â all possible variants, which is where enumeration gets its name.</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ç§æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­è¡¨è¾¾çš„æƒ…å†µå¹¶ä¸”æ¥è§£é‡Šä¸ºä»€ä¹ˆæšä¸¾æ˜¯æœ‰ç”¨çš„ï¼Œä¸”åœ¨è¿™ç§æƒ…å†µä¸‹æ¯”ç»“æ„ä½“æ˜¯æ›´é€‚åˆçš„ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ä½¿ç”¨IPåœ°å€ã€‚ç›®å‰ï¼ŒIPåœ°å€æœ‰ä¸¤ç§ä¸»æµæ ‡å‡†ï¼Œ<code>V4</code>å’Œ<code>V6</code>.åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œè¿™äº›æ˜¯å”¯ä¸€å¯èƒ½é‡åˆ°çš„IPåœ°å€å½¢å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æšä¸¾æ‰€æœ‰çš„å¯èƒ½ï¼Œè¿™å°±æ˜¯æšä¸¾åç§°çš„æ¥æºã€‚</p><p>Any IP address can be either a version four or a version six address, but not both at the same time. That property of IP addresses makes the enum data structure appropriate, because an enum value can only be one of its variants. Both version four and version six addresses are still fundamentally IP addresses, so they should be treated as the same type when the code is handling situations that apply to any kind of IP address.</p><p>ä»»ä½•IPåœ°å€éƒ½å¯ä»¥æ˜¯<code>V4</code>æˆ–è€…<code>V6</code>ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶æ˜¯ä¸¤è€…ã€‚IPåœ°å€çš„è¿™ä¸ªå±æ€§ä½¿å¾—æšä¸¾æ˜¯åˆé€‚çš„ï¼Œå› ä¸ºæšä¸¾æˆå‘˜åªèƒ½æ˜¯å®ƒæ‰€æœ‰å¯èƒ½ä¸­çš„ä¸€ä¸ªã€‚<code>V4</code>å’Œ<code>V6</code>åœ°å€éƒ½æ˜¯IPåœ°å€ï¼Œæ‰€ä»¥å½“ä»£ç å¤„ç†é€‚ç”¨äºä»»ä½•IPåœ°å€çš„æƒ…å†µæ—¶ï¼Œå®ƒä»¬åº”è¯¥è¢«å½“åšåŒä¸€ç§ç±»å‹ã€‚</p><p>We can express this concept in code by defining anÂ <code>IpAddrKind</code>Â enumeration and listing the possible kinds an IP address can be,Â <code>V4</code>Â andÂ <code>V6</code>. These are the variants of the enum:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>IpAddrKind</span> {
</span></span><span style=display:flex><span>    V4,
</span></span><span style=display:flex><span>    V6,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>IpAddrKind</code>Â is now a custom data type that we can use elsewhere in our code.
æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­è¡¨ç¤ºè¿™ä¸ªæ¦‚å¿µï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ª<code>IpAddrKind</code>æšä¸¾ï¼Œå¹¶ä¸”åˆ—å‡ºIPåœ°å€æ‰€æœ‰çš„ç±»å‹ã€‚</p><p><code>IpAddrKind</code>Â ç°åœ¨æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚</p><h3 id=enum-values>Enum Values<a hidden class=anchor aria-hidden=true href=#enum-values>#</a></h3><p>We can create instances of each of the two variants ofÂ <code>IpAddrKind</code>Â like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>	<span style=color:#66d9ef>let</span> four <span style=color:#f92672>=</span> IpAddrKind::V4;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>let</span> six <span style=color:#f92672>=</span> IpAddrKind::V6;
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åˆ›å»ºè¿™ä¸¤ä¸ªæšä¸¾æˆå‘˜çš„æ¯ä¸ªå®ä¾‹ã€‚</p><p>Note that the variants of the enum are namespaced under its identifier, and we use a double colon to separate the two. This is useful because now both valuesÂ <code>IpAddrKind::V4</code>Â andÂ <code>IpAddrKind::V6</code>Â are of the same type:Â <code>IpAddrKind</code>. We can then, for instance, define a function that takes anyÂ <code>IpAddrKind</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>route</span>(ip_kind: <span style=color:#a6e22e>IpAddrKind</span>) {}
</span></span></code></pre></div><p>And we can call this function with either variant:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>	route(IpAddrKind::V4);
</span></span><span style=display:flex><span>	route(IpAddrKind::V6);
</span></span></code></pre></div><p>æ³¨æ„ï¼Œæšä¸¾çš„æˆå‘˜ä½äºå…¶æšä¸¾æ ‡è¯†ç¬¦çš„å‘½åç©ºé—´ä¸‹ï¼Œä½¿ç”¨ä¸¤ä¸ªå†’å·åˆ†éš”ï¼Œè¿™ä¹ˆè®¾è®¡çš„ç›Šå¤„æ˜¯ç°åœ¨Â <code>IpAddrKind::V4</code>Â å’ŒÂ <code>IpAddrKind::V6</code>Â éƒ½æ˜¯Â <code>IpAddrKind</code>Â ç±»å‹çš„ã€‚ä¾‹å¦‚ï¼Œæ¥ç€å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è·å–ä»»ä½•Â <code>IpAddrKind</code>ï¼š</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä¸€è¯¥æšä¸¾çš„æˆå‘˜æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š</p><p>Using enums has even more advantages. Thinking more about our IP address type, at the moment we donâ€™t have a way to store the actual IP addressÂ <em>data</em>; we only know whatÂ <em>kind</em>Â it is. Given that you just learned about structs in Chapter 5, you might be tempted to tackle this problem with structs as shown in Listing 6-1.</p><p>ä½¿ç”¨æšä¸¾è¿˜æœ‰æ›´å¤šä¼˜ç‚¹ï¼Œè¿›ä¸€æ­¥è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬çš„ IP åœ°å€ç±»å‹ï¼Œç›®å‰æ²¡æœ‰ä¸€ä¸ªå­˜å‚¨å®é™… IP åœ°å€Â <strong>æ•°æ®</strong>Â çš„æ–¹æ³•ï¼›åªçŸ¥é“å®ƒæ˜¯ä»€ä¹ˆÂ <strong>ç±»å‹</strong>Â çš„ã€‚è€ƒè™‘åˆ°å·²ç»åœ¨ç¬¬ 5 ç« å­¦ä¹ è¿‡ç»“æ„ä½“äº†ï¼Œä½ å¯èƒ½ä¼šåƒç¤ºä¾‹ 6-1 é‚£æ ·å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>IpAddrKind</span> {
</span></span><span style=display:flex><span>        V4,
</span></span><span style=display:flex><span>        V6,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>IpAddr</span> {
</span></span><span style=display:flex><span>        kind: <span style=color:#a6e22e>IpAddrKind</span>,
</span></span><span style=display:flex><span>        address: String,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> home <span style=color:#f92672>=</span> IpAddr {
</span></span><span style=display:flex><span>        kind: <span style=color:#a6e22e>IpAddrKind</span>::V4,
</span></span><span style=display:flex><span>        address: String::from(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>),
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> loopback <span style=color:#f92672>=</span> IpAddr {
</span></span><span style=display:flex><span>        kind: <span style=color:#a6e22e>IpAddrKind</span>::V6,
</span></span><span style=display:flex><span>        address: String::from(<span style=color:#e6db74>&#34;::1&#34;</span>),
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Listing 6-1: Storing the data andÂ <code>IpAddrKind</code>Â variant of an IP address using aÂ <code>struct</code>
ç¤ºä¾‹ 6-1ï¼šå°† IP åœ°å€çš„æ•°æ®å’ŒÂ <code>IpAddrKind</code>Â æˆå‘˜å­˜å‚¨åœ¨ä¸€ä¸ªÂ <code>struct</code>Â ä¸­</p><p>Here, weâ€™ve defined a structÂ <code>IpAddr</code>Â that has two fields: aÂ <code>kind</code>Â field that is of typeÂ <code>IpAddrKind</code>Â (the enum we defined previously) and anÂ <code>address</code>Â field of typeÂ <code>String</code>. We have two instances of this struct. The first isÂ <code>home</code>, and it has the valueÂ <code>IpAddrKind::V4</code>Â as itsÂ <code>kind</code>Â with associated address data ofÂ <code>127.0.0.1</code>. The second instance isÂ <code>loopback</code>. It has the other variant ofÂ <code>IpAddrKind</code>Â as itsÂ <code>kind</code>Â value,Â <code>V6</code>, and has addressÂ <code>::1</code>Â associated with it. Weâ€™ve used a struct to bundle theÂ <code>kind</code>Â andÂ <code>address</code>Â values together, so now the variant is associated with the value.</p><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­—æ®µçš„ç»“æ„ä½“ï¼ŒÂ <code>IpAddrKind</code>ï¼ˆä¹‹å‰å®šä¹‰çš„æšä¸¾ï¼‰ç±»å‹çš„Â <code>kind</code>Â å­—æ®µå’ŒÂ <code>String</code>Â ç±»å‹Â <code>address</code>Â å­—æ®µã€‚æˆ‘ä»¬æœ‰è¿™ä¸ªç»“æ„ä½“çš„ä¸¤ä¸ªå®ä¾‹ã€‚ç¬¬ä¸€ä¸ªï¼Œ<code>home</code>ï¼Œå®ƒçš„Â <code>kind</code>Â çš„å€¼æ˜¯Â <code>IpAddrKind::V4</code>Â ï¼Œä¸ä¹‹ç›¸å…³è”çš„åœ°å€æ•°æ®æ˜¯Â <code>127.0.0.1</code>ã€‚ç¬¬äºŒä¸ªå®ä¾‹ï¼Œ<code>loopback</code>ï¼Œ<code>kind</code>Â çš„å€¼æ˜¯Â <code>IpAddrKind</code>Â çš„å¦ä¸€ä¸ªæˆå‘˜ï¼Œ<code>V6</code>ï¼Œå…³è”çš„åœ°å€æ˜¯Â <code>::1</code>ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç»“æ„ä½“æ¥å°†Â <code>kind</code>Â å’ŒÂ <code>address</code>Â æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç°åœ¨æšä¸¾æˆå‘˜å°±ä¸å€¼ç›¸å…³è”äº†ã€‚</p><p>However, representing the same concept using just an enum is more concise: rather than an enum inside a struct, we can put data directly into each enum variant. This new definition of theÂ <code>IpAddr</code>Â enum says that bothÂ <code>V4</code>Â andÂ <code>V6</code>Â variants will have associatedÂ <code>String</code>Â values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>IpAddr</span> {
</span></span><span style=display:flex><span>    V4(String),
</span></span><span style=display:flex><span>    V6(String),
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> home <span style=color:#f92672>=</span> IpAddr::V4(String::from(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> loopback <span style=color:#f92672>=</span> IpAddr::V6(String::from(<span style=color:#e6db74>&#34;::1&#34;</span>));
</span></span></code></pre></div><p>ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æšä¸¾æ¥æ›´ç®€æ´åœ°è¡¨è¾¾ç›¸åŒçš„æ¦‚å¿µï¼Œä¸æ˜¯å°†æšä¸¾ä½œä¸ºç»“æ„ä½“çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜ã€‚è¿™é‡Œ<code>IpAddr</code>Â æšä¸¾çš„æ–°å®šä¹‰ï¼ŒÂ <code>V4</code>Â å’ŒÂ <code>V6</code>Â æˆå‘˜éƒ½å…³è”äº†Â <code>String</code>å€¼ï¼š</p><p>We attach data to each variant of the enum directly, so there is no need for an extra struct. Here itâ€™s also easier to see another detail of how enums work: the name of each enum variant that we define also becomes a function that constructs an instance of the enum. That is,Â <code>IpAddr::V4()</code>Â is a function call that takes aÂ <code>String</code>Â argument and returns an instance of theÂ <code>IpAddr</code>Â type. We automatically get this constructor function defined as a result of defining the enum.</p><p>æˆ‘ä»¬å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„ç»“æ„ä½“ã€‚è¿™é‡Œä¹Ÿèƒ½å¤Ÿçœ‹åˆ°æšä¸¾ç”¨æ³•çš„å¦ä¸€ä¸ªç»†èŠ‚ï¼Œæˆ‘ä»¬æ‰€å®šä¹‰çš„æ¯ä¸€æšä¸¾æˆå‘˜çš„åç§°åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>IpAddr::V4()</code>æ˜¯ä¸€ä¸ªä»¥Â <code>String</code>Â ä½œä¸ºå‚æ•°ï¼Œä¸”è¿”å›ä¸€ä¸ª<code>IpAddr</code>ç±»å‹å®ä¾‹çš„å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æ˜¯æˆ‘ä»¬åœ¨å®šä¹‰æšä¸¾æ—¶å°±è‡ªåŠ¨å¾—åˆ°çš„ä¸€ä¸ªç»“æœã€‚</p><p>Thereâ€™s another advantage to using an enum rather than a struct: each variant can have different types and amounts of associated data. Version four type IP addresses will always have four numeric components that will have values between 0 and 255. If we wanted to storeÂ <code>V4</code>Â addresses as fourÂ <code>u8</code>Â values but still expressÂ <code>V6</code>Â addresses as oneÂ <code>String</code>Â value, we wouldnâ€™t be able to with a struct. Enums handle this case with ease:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>IpAddr</span> {
</span></span><span style=display:flex><span>        V4(<span style=color:#66d9ef>u8</span>, <span style=color:#66d9ef>u8</span>, <span style=color:#66d9ef>u8</span>, <span style=color:#66d9ef>u8</span>),
</span></span><span style=display:flex><span>        V6(String),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> home <span style=color:#f92672>=</span> IpAddr::V4(<span style=color:#ae81ff>127</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> loopback <span style=color:#f92672>=</span> IpAddr::V6(String::from(<span style=color:#e6db74>&#34;::1&#34;</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿˜æœ‰å¦ä¸€ä¸ªæšä¸¾æ¯”ç»“æ„ä½“æ›´åˆé€‚çš„ä¾‹å­ï¼Œæ¯ä¸ªæšä¸¾æˆå‘˜å¯ä»¥æœ‰ä¸åŒçš„ç±»å‹å’Œæ•°æ®æ•°é‡ï¼Œ<code>IPV4</code>åœ°å€çš„æ ¼å¼æ€»æ˜¯ç”±å››ä¸ª0-255ä¹‹é—´çš„æ•°å­—ç»„æˆã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠ<code>V4</code>åœ°å€ä»¥å››ä¸ª<code>u8</code>ç±»å‹å€¼è¿›è¡Œå­˜å‚¨ä½†åŒæ—¶ä»ç”¨<code>String</code>ç±»å‹è¡¨ç¤º<code>V6</code>åœ°å€ï¼Œä½¿ç”¨ç»“æ„ä½“æ˜¯åšä¸åˆ°çš„ã€‚æšä¸¾å¯ä»¥å¾ˆç®€å•åœ°å¤„ç†è¿™ä¸ªæƒ…å†µ:</p><p>Weâ€™ve shown several different ways to define data structures to store version four and version six IP addresses. However, as it turns out, wanting to store IP addresses and encode which kind they are is so common thatÂ <a href=https://doc.rust-lang.org/stable/std/net/enum.IpAddr.html>the standard library has a definition we can use!</a>Â Letâ€™s look at how the standard library definesÂ <code>IpAddr</code>: it has the exact enum and variants that weâ€™ve defined and used, but it embeds the address data inside the variants in the form of two different structs, which are defined differently for each variant:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Ipv4Addr</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// --snip--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Ipv6Addr</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// --snip--
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>IpAddr</span> {
</span></span><span style=display:flex><span>    V4(Ipv4Addr),
</span></span><span style=display:flex><span>    V6(Ipv6Addr),
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æˆ‘ä»¬å·²ç»åˆ—ä¸¾äº†å¥½å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰ç”¨äºå­˜å‚¨<code>V4</code>å’Œ<code>V6</code>IPåœ°å€çš„æ•°æ®ç»“æ„ï¼Œç„¶è€Œï¼Œäº‹å®è¯æ˜ï¼Œå­˜å‚¨IPåœ°å€å’Œç¼–ç å®ƒä»¬çš„ç§ç±»å®åœ¨æ˜¯å¤ªå¸¸è§äº†ï¼Œä»¥è‡³äºæ ‡å‡†åº“å·²ç»åŒ…å«äº†æˆ‘ä»¬èƒ½ç”¨çš„å®šä¹‰ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ ‡å‡†åº“å¦‚ä½•å®šä¹‰<code>IpAddr</code>:
å®ƒçš„æšä¸¾å’Œæˆå‘˜å’Œæˆ‘ä»¬æ‰€å®šä¹‰åŠä½¿ç”¨çš„æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡å®ƒç”¨ä¸¤ä¸ªä¸åŒçš„ç»“æ„çš„å½¢å¼å°†åœ°å€æ•°æ®åµŒå…¥åˆ°æšä¸¾æˆå‘˜ä¸­ï¼Œæ¯ä¸ªæˆå‘˜çš„ç»“æ„ä½“å®šä¹‰æ˜¯ä¸åŒçš„ï¼š</p><p>This code illustrates that you can put any kind of data inside an enum variant: strings, numeric types, or structs, for example. You can even include another enum! Also, standard library types are often not much more complicated than what you might come up with.</p><p>è¿™äº›ä»£ç è¯´æ˜ä½ å¯ä»¥æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®åˆ°æšä¸¾æˆå‘˜ä¸­ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ç±»å‹å’Œç»“æ„ä½“ï¼Œç”šè‡³ä½ å¯ä»¥æ”¾å¦ä¸€ä¸ªæšä¸¾ï¼å¹¶ä¸”ï¼Œæ ‡å‡†åº“çš„ç±»å‹é€šå¸¸ä¸ä¼šæ¯”ä½ èƒ½ç¢°åˆ°çš„å¤æ‚å¤šå°‘ã€‚</p><p>Note that even though the standard library contains a definition forÂ <code>IpAddr</code>, we can still create and use our own definition without conflict because we havenâ€™t brought the standard libraryâ€™s definition into our scope. Weâ€™ll talk more about bringing types into scope in Chapter 7.</p><p>æ³¨æ„ï¼Œå³ä½¿æ ‡å‡†åº“å·²ç»åŒ…å«äº†å¯¹<code>IpAddr</code>çš„å®šä¹‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä»å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å®šä¹‰ï¼Œä¸ä¼šæœ‰å†²çªï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æŠŠæ ‡å‡†åº“å®šä¹‰å¼•å…¥æˆ‘ä»¬çš„ä½œç”¨åŸŸæ¥ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ä¸ƒç« è°ˆè®ºå¦‚ä½•åšåˆ°è¿™ä¸ªã€‚</p><p>Letâ€™s look at another example of an enum in Listing 6-2: this one has a wide variety of types embedded in its variants.</p><p>è®©æˆ‘ä»¬æ¥çœ‹6-2çš„ä¾‹å­ä¸­çš„å¦ä¸€ä¸ªæšä¸¾ï¼šè¿™ä¸ªæšä¸¾çš„æˆå‘˜åµŒå…¥äº†å„ç§å„æ ·çš„ç±»å‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Message</span> {
</span></span><span style=display:flex><span>    Quit,
</span></span><span style=display:flex><span>    Move { x: <span style=color:#66d9ef>i32</span>, y: <span style=color:#66d9ef>i32</span> },
</span></span><span style=display:flex><span>    Write(String),
</span></span><span style=display:flex><span>    ChangeColor(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>),
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Listing 6-2: AÂ <code>Message</code>Â enum whose variants each store different amounts and types of values
Listing 6-2: ä¸€ä¸ªåä¸º<code>Message</code>çš„æšä¸¾ï¼Œå…¶æ¯ä¸ªæˆå‘˜éƒ½å­˜å‚¨äº†ä¸åŒæ•°é‡å’Œç±»å‹çš„å€¼</p><p>This enum has four variants with different types:</p><ul><li><code>Quit</code>Â has no data associated with it at all.</li><li><code>Move</code>Â has named fields like a struct does.</li><li><code>Write</code>Â includes a singleÂ <code>String</code>.</li><li><code>ChangeColor</code>Â includes threeÂ <code>i32</code>Â values.</li></ul><p>è¿™ä¸ªæšä¸¾æœ‰å››ä¸ªä¸åŒç±»å‹çš„æˆå‘˜ï¼š</p><ul><li><code>Quit</code>ï¼Œæ²¡æœ‰å…³è”æ•°æ®</li><li><code>Move</code>ï¼Œæœ‰å’Œç»“æ„ä½“ä¸€æ ·çš„å‘½åå­—æ®µ</li><li><code>Write</code>ï¼ŒåŒ…å«äº†å•ç‹¬çš„ä¸€ä¸ª<code>String</code></li><li><code>ChangeColor</code>ï¼ŒåŒ…å«äº†ä¸‰ä¸ª<code>i32</code>å€¼</li></ul><p>Defining an enum with variants such as the ones in Listing 6-2 is similar to defining different kinds of struct definitions, except the enum doesnâ€™t use theÂ <code>struct</code>Â keyword and all the variants are grouped together under theÂ <code>Message</code>Â type. The following structs could hold the same data that the preceding enum variants hold:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>QuitMessage</span>; <span style=color:#75715e>// ç±»å•å…ƒç»“æ„ä½“
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>MoveMessage</span> {
</span></span><span style=display:flex><span>    x: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>    y: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>WriteMessage</span>(String); <span style=color:#75715e>// å…ƒç»„ç»“æ„ä½“
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ChangeColorMessage</span>(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>); <span style=color:#75715e>// å…ƒç»„ç»“æ„ä½“
</span></span></span></code></pre></div><p>å®šä¹‰ä¸€ä¸ªå¦‚ç¤ºä¾‹ 6-2 ä¸­æ‰€ç¤ºé‚£æ ·çš„æœ‰å…³è”å€¼çš„æšä¸¾çš„æ–¹å¼å’Œå®šä¹‰å¤šä¸ªä¸åŒç±»å‹çš„ç»“æ„ä½“çš„æ–¹å¼å¾ˆç›¸åƒï¼Œé™¤äº†æšä¸¾ä¸ä½¿ç”¨Â <code>struct</code>Â å…³é”®å­—ä»¥åŠå…¶æ‰€æœ‰æˆå‘˜éƒ½è¢«ç»„åˆåœ¨ä¸€èµ·ä½äºÂ <code>Message</code>Â ç±»å‹ä¸‹ã€‚å¦‚ä¸‹è¿™äº›ç»“æ„ä½“å¯ä»¥åŒ…å«ä¸ä¹‹å‰æšä¸¾æˆå‘˜ä¸­ç›¸åŒçš„æ•°æ®ï¼š</p><p>But if we used the different structs, which each have their own type, we couldnâ€™t as easily define a function to take any of these kinds of messages as we could with theÂ <code>Message</code>Â enum defined in Listing 6-2, which is a single type.</p><p>ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“ï¼Œç”±äºå®ƒä»¬éƒ½æœ‰ä¸åŒçš„ç±»å‹ï¼Œæˆ‘ä»¬å°†ä¸èƒ½åƒä½¿ç”¨ç¤ºä¾‹ 6-2 ä¸­å®šä¹‰çš„Â <code>Message</code>Â æšä¸¾é‚£æ ·ï¼Œè½»æ˜“çš„å®šä¹‰ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†è¿™äº›ä¸åŒç±»å‹çš„ç»“æ„ä½“çš„å‡½æ•°ï¼Œå› ä¸ºæšä¸¾æ˜¯å•ç‹¬ä¸€ä¸ªç±»å‹ã€‚</p><p>There is one more similarity between enums and structs: just as weâ€™re able to define methods on structs usingÂ <code>impl</code>, weâ€™re also able to define methods on enums. Hereâ€™s a method namedÂ <code>call</code>Â that we could define on ourÂ <code>Message</code>Â enum:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {  
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[derive(Debug)]</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Message</span> {  
</span></span><span style=display:flex><span>        Quit,  
</span></span><span style=display:flex><span>        Move { x: <span style=color:#66d9ef>i32</span>, y: <span style=color:#66d9ef>i32</span> },  
</span></span><span style=display:flex><span>        Write(String),  
</span></span><span style=display:flex><span>        ChangeColor(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>),  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>impl</span> Message {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>call</span>(<span style=color:#f92672>&amp;</span>self) {  
</span></span><span style=display:flex><span>            println!(<span style=color:#e6db74>&#34;{:?}&#34;</span>, self);  <span style=color:#75715e>// Write(&#34;hello&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> m <span style=color:#f92672>=</span> Message::Write(String::from(<span style=color:#e6db74>&#34;hello&#34;</span>));  
</span></span><span style=display:flex><span>    m.call();  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æšä¸¾å’Œç»“æ„ä½“è¿˜æœ‰å¦ä¸€ä¸ªç›¸ä¼¼ç‚¹ï¼šå°±åƒå¯ä»¥ä½¿ç”¨Â <code>impl</code>Â æ¥ä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•é‚£æ ·ï¼Œä¹Ÿå¯ä»¥åœ¨æšä¸¾ä¸Šå®šä¹‰æ–¹æ³•ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨Â <code>Message</code>Â æšä¸¾ä¸Šå®šä¹‰äº†ä¸€ä¸ªå«åšÂ <code>call</code>Â çš„æ–¹æ³•ï¼š</p><p>The body of the method would useÂ <code>self</code>Â to get the value that we called the method on. In this example, weâ€™ve created a variableÂ <code>m</code>Â that has the valueÂ <code>Message::Write(String::from("hello"))</code>, and that is whatÂ <code>self</code>Â will be in the body of theÂ <code>call</code>Â method whenÂ <code>m.call()</code>Â runs.</p><p>åœ¨æ–¹æ³•ä½“ä¸­ä½¿ç”¨äº†Â <code>self</code>Â æ¥è·å–æ–¹æ³•çš„è°ƒç”¨è€…ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå€¼ä¸ºÂ <code>Message::Write(String::from("hello"))</code>Â çš„å˜é‡Â <code>m</code>ï¼Œmå°±æ˜¯å½“Â <code>m.call()</code>Â è¿è¡Œæ—¶Â <code>call</code>Â æ–¹æ³•ä¸­çš„Â <code>self</code>Â çš„å€¼ã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.yici.xin/tags/rust/>rust</a></li><li><a href=https://www.yici.xin/tags/%E7%BF%BB%E8%AF%91/>ç¿»è¯‘</a></li></ul><nav class=paginav><a class=prev href=https://www.yici.xin/post/read/rust-option%E6%9E%9A%E4%B8%BE/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Rust Optionæšä¸¾</span></a>
<a class=next href=https://www.yici.xin/post/tech/go%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Goç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹</span></a></nav></footer><script type=text/javascript>let giscusTheme=localStorage.getItem("pref-theme")==="dark"?"dark_dimmed":"light",giscusAttributes={src:"https://giscus.app/client.js","data-repo":"yicixin/blog_comment","data-repo-id":"R_kgDOIr6QyQ","data-category":"Announcements","data-category-id":"DIC_kwDOIr6Qyc4CTSs3","data-mapping":"title","data-reactions-enabled":"1","data-emit-metadata":"0","data-theme":giscusTheme===null?"light":giscusTheme,"data-lang":"zh-CN",crossorigin:"anonymous","data-loading":"lazy",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t));var article=document.getElementsByTagName("article")[0].appendChild(giscusScript);function changeGiscusTheme(){const e=localStorage.getItem("pref-theme")==="dark"?"light":"dark_dimmed";function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}const toggle=document.querySelector("#theme-toggle");toggle&&toggle.addEventListener("click",changeGiscusTheme)</script><script src=https://giscus.app/client.js data-repo=yicixin/blog_comment data-repo-id=R_kgDOIr6QyQ data-category=Announcements data-category-id=DIC_kwDOIr6Qyc4CTSs3 data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.yici.xin/>yicixin's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="ctrl\u002bc";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="ctrl\u002bc"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://code.jquery.com/jquery-1.12.4.min.js></script>
<script>$("code[class^=language] ").on("mouseover",function(){this.clientWidth<this.scrollWidth&&$(this).css("width","135%")}).on("mouseout",function(){$(this).css("width","100%"),$(".copy-code").css("right","4px")})</script></body></html>