<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css integrity=sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js integrity=sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js integrity=sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl crossorigin=anonymous></script><title>Protobufè¯­æ³• | yicixin's blog</title><meta name=keywords content="protobuf"><meta name=description content="ä»€ä¹ˆæ˜¯protobufï¼Ÿ ä¸€ç§åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹å¼ï¼Œä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•ã€‚å’Œjsonä¸€æ ·ï¼Œä½†æ˜¯æ›´å°æ›´å¿«ã€‚
V3è¯­æ³•ä»‹ç» ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°ï¼Œæ–°å»ºä¸€ä¸ª.protoæ–‡ä»¶å¹¶å†™å…¥:
syntax = &#34;proto3&#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } .protoæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†å½“å‰æ­£åœ¨ä½¿ç”¨proto3è¯­æ³•ï¼Œå¦‚æœæœªå†™ï¼Œprotoçš„ç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨proto2çš„è¯­æ³•è¿›è¡Œè§£æã€‚
SearchRequestå®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼Œå®ƒä»¬éƒ½æœ‰ç±»å‹å’Œåç§°ï¼Œå¹¶ä¸”åœ¨æœ€åç»™äº†ä¸€ä¸ªå”¯ä¸€ç¼–å·ï¼Œç¼–å·çš„ä½œç”¨æ˜¯åœ¨åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶åºåˆ—ä¸­æ ‡è¯†å­—æ®µã€‚å½“ç¼–å·ä¸º1-15çš„èŒƒå›´å†…æ—¶ï¼Œåœ¨ç¼–ç æ—¶åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ16-2047å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› å¯ä»¥äº†è§£ä¸€ä¸‹protobufçš„ç¼–ç åŸç†ã€‚æ‰€ä»¥ï¼Œ1-15çš„ç¼–å·æœ€å¥½è¦ä¿ç•™ç»™é‚£äº›æœ€ç»å¸¸å‡ºç°çš„å­—æ®µã€‚ä½ èƒ½ä½¿ç”¨çš„æœ€å°ç¼–å·æ˜¯1ï¼Œæœ€å¤§æ˜¯$2^{29}$-1ï¼Œä¸è¿‡ä½ ä¸èƒ½ä½¿ç”¨19000-19999ï¼Œè¿™äº›ç¼–å·ä¸ºprotobufçš„å®ç°è€Œé¢„ä¿ç•™äº†ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ï¼Œæ˜¯è¿‡ä¸äº†ç¼–è¯‘çš„ã€‚
åœ¨å•ä¸ª.protoæ–‡ä»¶ä¸­èƒ½å®šä¹‰å¤šä¸ªmessageç±»å‹:
syntax = &#34;proto3&#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } message SearchResponse { repeated string data = 1; int32 total = 2; } repeatedè¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¯é‡å¤å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ã€‚
æ³¨é‡Šçš„å†™æ³•:
syntax = &#34;proto3&#34;; /* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } /* å“åº”ç»“æ„ */ message SearchResponse { repeated string data = 1; int32 total = 2; // æ€»æ•° } å¦‚æœæˆ‘ä»¬åœ¨æ›´æ–°message typeæ—¶ï¼Œæ˜¯ç›´æ¥åˆ é™¤æˆ–è€…æ³¨é‡Šäº†å­—æ®µï¼Œåœ¨ä¹‹åå…¶ä»–äººæ¥æ›´æ–°æ—¶å¯èƒ½ä¼šå¤ç”¨è¢«åˆ é™¤æˆ–æ³¨é‡Šçš„å­—æ®µç¼–å·ï¼Œå¦‚æœè¿™æ—¶åŠ è½½äº†ç›¸åŒprotoçš„æ—§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ‰€ä»¥protobufæä¾›äº†ä¿ç•™å­—æ®µçš„æœºåˆ¶ï¼Œä½¿ç”¨reservedå…³é”®å­—ï¼Œå¯ä»¥ä¿ç•™ç¼–å·æˆ–è€…å­—æ®µåã€‚"><meta name=author content="å£¹æ¬¡å¿ƒ"><link rel=canonical href=https://www.yici.xin/post/tech/protobuf%E8%AF%AD%E6%B3%95/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.00d594ac5404702263b7df2f247aae4053818963176b093f9b95a1fc7e4e0b42.css integrity="sha256-ANWUrFQEcCJjt98vJHquQFOBiWMXawk/m5Wh/H5OC0I=" rel="preload stylesheet" as=style><link rel=icon href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=icon type=image/png sizes=16x16 href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=icon type=image/png sizes=32x32 href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=apple-touch-icon href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><link rel=mask-icon href=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Protobufè¯­æ³•"><meta property="og:description" content="ä»€ä¹ˆæ˜¯protobufï¼Ÿ ä¸€ç§åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹å¼ï¼Œä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•ã€‚å’Œjsonä¸€æ ·ï¼Œä½†æ˜¯æ›´å°æ›´å¿«ã€‚
V3è¯­æ³•ä»‹ç» ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°ï¼Œæ–°å»ºä¸€ä¸ª.protoæ–‡ä»¶å¹¶å†™å…¥:
syntax = &#34;proto3&#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } .protoæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†å½“å‰æ­£åœ¨ä½¿ç”¨proto3è¯­æ³•ï¼Œå¦‚æœæœªå†™ï¼Œprotoçš„ç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨proto2çš„è¯­æ³•è¿›è¡Œè§£æã€‚
SearchRequestå®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼Œå®ƒä»¬éƒ½æœ‰ç±»å‹å’Œåç§°ï¼Œå¹¶ä¸”åœ¨æœ€åç»™äº†ä¸€ä¸ªå”¯ä¸€ç¼–å·ï¼Œç¼–å·çš„ä½œç”¨æ˜¯åœ¨åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶åºåˆ—ä¸­æ ‡è¯†å­—æ®µã€‚å½“ç¼–å·ä¸º1-15çš„èŒƒå›´å†…æ—¶ï¼Œåœ¨ç¼–ç æ—¶åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ16-2047å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› å¯ä»¥äº†è§£ä¸€ä¸‹protobufçš„ç¼–ç åŸç†ã€‚æ‰€ä»¥ï¼Œ1-15çš„ç¼–å·æœ€å¥½è¦ä¿ç•™ç»™é‚£äº›æœ€ç»å¸¸å‡ºç°çš„å­—æ®µã€‚ä½ èƒ½ä½¿ç”¨çš„æœ€å°ç¼–å·æ˜¯1ï¼Œæœ€å¤§æ˜¯$2^{29}$-1ï¼Œä¸è¿‡ä½ ä¸èƒ½ä½¿ç”¨19000-19999ï¼Œè¿™äº›ç¼–å·ä¸ºprotobufçš„å®ç°è€Œé¢„ä¿ç•™äº†ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ï¼Œæ˜¯è¿‡ä¸äº†ç¼–è¯‘çš„ã€‚
åœ¨å•ä¸ª.protoæ–‡ä»¶ä¸­èƒ½å®šä¹‰å¤šä¸ªmessageç±»å‹:
syntax = &#34;proto3&#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } message SearchResponse { repeated string data = 1; int32 total = 2; } repeatedè¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¯é‡å¤å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ã€‚
æ³¨é‡Šçš„å†™æ³•:
syntax = &#34;proto3&#34;; /* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } /* å“åº”ç»“æ„ */ message SearchResponse { repeated string data = 1; int32 total = 2; // æ€»æ•° } å¦‚æœæˆ‘ä»¬åœ¨æ›´æ–°message typeæ—¶ï¼Œæ˜¯ç›´æ¥åˆ é™¤æˆ–è€…æ³¨é‡Šäº†å­—æ®µï¼Œåœ¨ä¹‹åå…¶ä»–äººæ¥æ›´æ–°æ—¶å¯èƒ½ä¼šå¤ç”¨è¢«åˆ é™¤æˆ–æ³¨é‡Šçš„å­—æ®µç¼–å·ï¼Œå¦‚æœè¿™æ—¶åŠ è½½äº†ç›¸åŒprotoçš„æ—§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ‰€ä»¥protobufæä¾›äº†ä¿ç•™å­—æ®µçš„æœºåˆ¶ï¼Œä½¿ç”¨reservedå…³é”®å­—ï¼Œå¯ä»¥ä¿ç•™ç¼–å·æˆ–è€…å­—æ®µåã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://www.yici.xin/post/tech/protobuf%E8%AF%AD%E6%B3%95/"><meta property="og:image" content="https://www.yici.xin/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-12-27T18:02:40+08:00"><meta property="article:modified_time" content="2022-12-27T18:02:40+08:00"><meta property="og:site_name" content="yicixin's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.yici.xin/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Protobufè¯­æ³•"><meta name=twitter:description content="ä»€ä¹ˆæ˜¯protobufï¼Ÿ ä¸€ç§åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹å¼ï¼Œä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•ã€‚å’Œjsonä¸€æ ·ï¼Œä½†æ˜¯æ›´å°æ›´å¿«ã€‚
V3è¯­æ³•ä»‹ç» ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°ï¼Œæ–°å»ºä¸€ä¸ª.protoæ–‡ä»¶å¹¶å†™å…¥:
syntax = &#34;proto3&#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } .protoæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†å½“å‰æ­£åœ¨ä½¿ç”¨proto3è¯­æ³•ï¼Œå¦‚æœæœªå†™ï¼Œprotoçš„ç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨proto2çš„è¯­æ³•è¿›è¡Œè§£æã€‚
SearchRequestå®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼Œå®ƒä»¬éƒ½æœ‰ç±»å‹å’Œåç§°ï¼Œå¹¶ä¸”åœ¨æœ€åç»™äº†ä¸€ä¸ªå”¯ä¸€ç¼–å·ï¼Œç¼–å·çš„ä½œç”¨æ˜¯åœ¨åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶åºåˆ—ä¸­æ ‡è¯†å­—æ®µã€‚å½“ç¼–å·ä¸º1-15çš„èŒƒå›´å†…æ—¶ï¼Œåœ¨ç¼–ç æ—¶åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ16-2047å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› å¯ä»¥äº†è§£ä¸€ä¸‹protobufçš„ç¼–ç åŸç†ã€‚æ‰€ä»¥ï¼Œ1-15çš„ç¼–å·æœ€å¥½è¦ä¿ç•™ç»™é‚£äº›æœ€ç»å¸¸å‡ºç°çš„å­—æ®µã€‚ä½ èƒ½ä½¿ç”¨çš„æœ€å°ç¼–å·æ˜¯1ï¼Œæœ€å¤§æ˜¯$2^{29}$-1ï¼Œä¸è¿‡ä½ ä¸èƒ½ä½¿ç”¨19000-19999ï¼Œè¿™äº›ç¼–å·ä¸ºprotobufçš„å®ç°è€Œé¢„ä¿ç•™äº†ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ï¼Œæ˜¯è¿‡ä¸äº†ç¼–è¯‘çš„ã€‚
åœ¨å•ä¸ª.protoæ–‡ä»¶ä¸­èƒ½å®šä¹‰å¤šä¸ªmessageç±»å‹:
syntax = &#34;proto3&#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } message SearchResponse { repeated string data = 1; int32 total = 2; } repeatedè¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¯é‡å¤å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ã€‚
æ³¨é‡Šçš„å†™æ³•:
syntax = &#34;proto3&#34;; /* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } /* å“åº”ç»“æ„ */ message SearchResponse { repeated string data = 1; int32 total = 2; // æ€»æ•° } å¦‚æœæˆ‘ä»¬åœ¨æ›´æ–°message typeæ—¶ï¼Œæ˜¯ç›´æ¥åˆ é™¤æˆ–è€…æ³¨é‡Šäº†å­—æ®µï¼Œåœ¨ä¹‹åå…¶ä»–äººæ¥æ›´æ–°æ—¶å¯èƒ½ä¼šå¤ç”¨è¢«åˆ é™¤æˆ–æ³¨é‡Šçš„å­—æ®µç¼–å·ï¼Œå¦‚æœè¿™æ—¶åŠ è½½äº†ç›¸åŒprotoçš„æ—§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ‰€ä»¥protobufæä¾›äº†ä¿ç•™å­—æ®µçš„æœºåˆ¶ï¼Œä½¿ç”¨reservedå…³é”®å­—ï¼Œå¯ä»¥ä¿ç•™ç¼–å·æˆ–è€…å­—æ®µåã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.yici.xin/post/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯","item":"https://www.yici.xin/post/tech/"},{"@type":"ListItem","position":3,"name":"Protobufè¯­æ³•","item":"https://www.yici.xin/post/tech/protobuf%E8%AF%AD%E6%B3%95/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Protobufè¯­æ³•","name":"Protobufè¯­æ³•","description":"ä»€ä¹ˆæ˜¯protobufï¼Ÿ ä¸€ç§åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹å¼ï¼Œä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•ã€‚å’Œjsonä¸€æ ·ï¼Œä½†æ˜¯æ›´å°æ›´å¿«ã€‚\nV3è¯­æ³•ä»‹ç» ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°ï¼Œæ–°å»ºä¸€ä¸ª.protoæ–‡ä»¶å¹¶å†™å…¥:\nsyntax = \u0026#34;proto3\u0026#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } .protoæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†å½“å‰æ­£åœ¨ä½¿ç”¨proto3è¯­æ³•ï¼Œå¦‚æœæœªå†™ï¼Œprotoçš„ç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨proto2çš„è¯­æ³•è¿›è¡Œè§£æã€‚\nSearchRequestå®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼Œå®ƒä»¬éƒ½æœ‰ç±»å‹å’Œåç§°ï¼Œå¹¶ä¸”åœ¨æœ€åç»™äº†ä¸€ä¸ªå”¯ä¸€ç¼–å·ï¼Œç¼–å·çš„ä½œç”¨æ˜¯åœ¨åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶åºåˆ—ä¸­æ ‡è¯†å­—æ®µã€‚å½“ç¼–å·ä¸º1-15çš„èŒƒå›´å†…æ—¶ï¼Œåœ¨ç¼–ç æ—¶åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ16-2047å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› å¯ä»¥äº†è§£ä¸€ä¸‹protobufçš„ç¼–ç åŸç†ã€‚æ‰€ä»¥ï¼Œ1-15çš„ç¼–å·æœ€å¥½è¦ä¿ç•™ç»™é‚£äº›æœ€ç»å¸¸å‡ºç°çš„å­—æ®µã€‚ä½ èƒ½ä½¿ç”¨çš„æœ€å°ç¼–å·æ˜¯1ï¼Œæœ€å¤§æ˜¯$2^{29}$-1ï¼Œä¸è¿‡ä½ ä¸èƒ½ä½¿ç”¨19000-19999ï¼Œè¿™äº›ç¼–å·ä¸ºprotobufçš„å®ç°è€Œé¢„ä¿ç•™äº†ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ï¼Œæ˜¯è¿‡ä¸äº†ç¼–è¯‘çš„ã€‚\nåœ¨å•ä¸ª.protoæ–‡ä»¶ä¸­èƒ½å®šä¹‰å¤šä¸ªmessageç±»å‹:\nsyntax = \u0026#34;proto3\u0026#34;; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } message SearchResponse { repeated string data = 1; int32 total = 2; } repeatedè¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¯é‡å¤å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ã€‚\næ³¨é‡Šçš„å†™æ³•:\nsyntax = \u0026#34;proto3\u0026#34;; /* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } /* å“åº”ç»“æ„ */ message SearchResponse { repeated string data = 1; int32 total = 2; // æ€»æ•° } å¦‚æœæˆ‘ä»¬åœ¨æ›´æ–°message typeæ—¶ï¼Œæ˜¯ç›´æ¥åˆ é™¤æˆ–è€…æ³¨é‡Šäº†å­—æ®µï¼Œåœ¨ä¹‹åå…¶ä»–äººæ¥æ›´æ–°æ—¶å¯èƒ½ä¼šå¤ç”¨è¢«åˆ é™¤æˆ–æ³¨é‡Šçš„å­—æ®µç¼–å·ï¼Œå¦‚æœè¿™æ—¶åŠ è½½äº†ç›¸åŒprotoçš„æ—§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ‰€ä»¥protobufæä¾›äº†ä¿ç•™å­—æ®µçš„æœºåˆ¶ï¼Œä½¿ç”¨reservedå…³é”®å­—ï¼Œå¯ä»¥ä¿ç•™ç¼–å·æˆ–è€…å­—æ®µåã€‚","keywords":["protobuf"],"articleBody":"ä»€ä¹ˆæ˜¯protobufï¼Ÿ ä¸€ç§åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹å¼ï¼Œä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•ã€‚å’Œjsonä¸€æ ·ï¼Œä½†æ˜¯æ›´å°æ›´å¿«ã€‚\nV3è¯­æ³•ä»‹ç» ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°ï¼Œæ–°å»ºä¸€ä¸ª.protoæ–‡ä»¶å¹¶å†™å…¥:\nsyntax = \"proto3\"; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } .protoæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†å½“å‰æ­£åœ¨ä½¿ç”¨proto3è¯­æ³•ï¼Œå¦‚æœæœªå†™ï¼Œprotoçš„ç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨proto2çš„è¯­æ³•è¿›è¡Œè§£æã€‚\nSearchRequestå®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼Œå®ƒä»¬éƒ½æœ‰ç±»å‹å’Œåç§°ï¼Œå¹¶ä¸”åœ¨æœ€åç»™äº†ä¸€ä¸ªå”¯ä¸€ç¼–å·ï¼Œç¼–å·çš„ä½œç”¨æ˜¯åœ¨åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶åºåˆ—ä¸­æ ‡è¯†å­—æ®µã€‚å½“ç¼–å·ä¸º1-15çš„èŒƒå›´å†…æ—¶ï¼Œåœ¨ç¼–ç æ—¶åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ16-2047å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› å¯ä»¥äº†è§£ä¸€ä¸‹protobufçš„ç¼–ç åŸç†ã€‚æ‰€ä»¥ï¼Œ1-15çš„ç¼–å·æœ€å¥½è¦ä¿ç•™ç»™é‚£äº›æœ€ç»å¸¸å‡ºç°çš„å­—æ®µã€‚ä½ èƒ½ä½¿ç”¨çš„æœ€å°ç¼–å·æ˜¯1ï¼Œæœ€å¤§æ˜¯$2^{29}$-1ï¼Œä¸è¿‡ä½ ä¸èƒ½ä½¿ç”¨19000-19999ï¼Œè¿™äº›ç¼–å·ä¸ºprotobufçš„å®ç°è€Œé¢„ä¿ç•™äº†ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ï¼Œæ˜¯è¿‡ä¸äº†ç¼–è¯‘çš„ã€‚\nåœ¨å•ä¸ª.protoæ–‡ä»¶ä¸­èƒ½å®šä¹‰å¤šä¸ªmessageç±»å‹:\nsyntax = \"proto3\"; message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } message SearchResponse { repeated string data = 1; int32 total = 2; } repeatedè¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¯é‡å¤å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ã€‚\næ³¨é‡Šçš„å†™æ³•:\nsyntax = \"proto3\"; /* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; } /* å“åº”ç»“æ„ */ message SearchResponse { repeated string data = 1; int32 total = 2; // æ€»æ•° } å¦‚æœæˆ‘ä»¬åœ¨æ›´æ–°message typeæ—¶ï¼Œæ˜¯ç›´æ¥åˆ é™¤æˆ–è€…æ³¨é‡Šäº†å­—æ®µï¼Œåœ¨ä¹‹åå…¶ä»–äººæ¥æ›´æ–°æ—¶å¯èƒ½ä¼šå¤ç”¨è¢«åˆ é™¤æˆ–æ³¨é‡Šçš„å­—æ®µç¼–å·ï¼Œå¦‚æœè¿™æ—¶åŠ è½½äº†ç›¸åŒprotoçš„æ—§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ‰€ä»¥protobufæä¾›äº†ä¿ç•™å­—æ®µçš„æœºåˆ¶ï¼Œä½¿ç”¨reservedå…³é”®å­—ï¼Œå¯ä»¥ä¿ç•™ç¼–å·æˆ–è€…å­—æ®µåã€‚\nmessage Foo { reserved 2, 15, 9 to 11; reserved \"foo\", \"bar\"; int32 foo = 2; // ä¼šæŠ¥é”™ } æšä¸¾:\n/* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; enum Corpus { UNIVERSAL = 0; WEB = 1; IMAGES = 2; LOCAL = 3; NEWS = 4; PRODUCTS = 5; VIDEO = 6; } Corpus corpus = 4; } æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæšä¸¾çš„ç¬¬ä¸€ä¸ªå­—æ®µå€¼å¿…é¡»ä¸º0ï¼Œå› ä¸ºè¿™æ ·æˆ‘ä»¬å°±èƒ½ç”¨0ä½œä¸ºæ•°å­—ç¼–å·çš„é»˜è®¤å€¼ï¼Œå¹¶ä¸”ä¸ºäº†å…¼å®¹proto2ï¼Œæšä¸¾çš„ç¬¬ä¸€ä¸ªå­—æ®µå³ä¸ºé»˜è®¤å€¼ã€‚\næšä¸¾çš„åˆ«åï¼Œå¦‚æœæŸæ—¶å€™å¸Œæœ›å¤šä¸ªæšä¸¾å­—æ®µä»£è¡¨åŒä¸€ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨åˆ«åæœºåˆ¶ï¼Œéœ€è¦è®¾ç½®option allow_aliasä¸ºtrue:\nsyntax = \"proto3\"; /* è¯·æ±‚ç»“æ„ */ message SearchRequest { string query = 1; int32 page_num = 2; int32 page_size = 3; enum Corpus { UNIVERSAL = 0; WEB = 1; IMAGES = 2; LOCAL = 3; NEWS = 4; PRODUCTS = 5; VIDEO = 6; } Corpus corpus = 4; } enum Corpus { UNIVERSAL = 0; WEB = 1; IMAGES = 2; LOCAL = 3; NEWS = 4; PRODUCTS = 5; VIDEO = 6; } message MyMessage1 { enum EnumAllowingAlias { option allow_alias = true; // å…è®¸åˆ«å UNKNOWN = 0; STARTED = 1; RUNNING = 1; } EnumAllowingAlias enum = 1; SearchRequest.Corpus corpus = 2; Corpus corpus2 = 3; } å¦‚ä¸Šï¼Œæšä¸¾çš„å£°æ˜å¯ä»¥ä¸åœ¨messageçš„å£°æ˜ä¸­ï¼Œåœ¨ä¸€ä¸ªmessageä¸­ä¹Ÿå¯ä»¥å¼•ç”¨å…¶ä»–messageä¸­å£°æ˜çš„æšä¸¾ã€‚\næšä¸¾å€¼çš„èŒƒå›´æ˜¯ä¸€ä¸ª32ä½çš„intï¼Œå› ä¸ºæšä¸¾åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯å˜é•¿ç¼–ç ï¼Œæ‰€ä»¥è´Ÿæ•°æ˜¯å¾ˆä½æ•ˆçš„ï¼Œä¸æ¨èã€‚\nå¯¼å…¥å…¶ä»–.protoæ–‡ä»¶ï¼Œå…ˆåœ¨golandä¸­é…ç½®protoå¯»æ‰¾è·¯å¾„ï¼Œæ·»åŠ æœ¬åœ°é¡¹ç›®åœ°å€ã€‚ ä¹‹ååœ¨.protoæ–‡ä»¶ä¸­ä½¿ç”¨importå…³é”®å­—è¿›è¡Œå¯¼å…¥:\nimport \"pb/route_guide.proto\"; æ­¤æ—¶æ ¹è·¯å¾„ä¸ºé¡¹ç›®æ ¹ç›®å½•\nprotoä¸­çš„map:\nmessage M { map\u003cstring, SearchRequest\u003e req_map = 1; } or message MapFieldEntry { key_type key = 1; value_type value = 2; } repeated MapFieldEntry map_field = N; æ³¨æ„:\nMap fields cannot beÂ repeated. Mapä¸­çš„æ•°æ®é¡ºåºä¸æ˜¯å›ºå®šçš„ ç”Ÿæˆä»£ç -ä»¥goä¸ºä¾‹ è¦ç”Ÿæˆgoä»£ç ï¼Œæˆ‘ä»¬è¦åœ¨protoæ–‡ä»¶é‡Œæ·»åŠ option go_packageçš„å®šä¹‰ï¼Œ The option defines the import path of the package which will contain all the generated code for this file, the Go package name will be the last path component of the import path.\nsyntax = \"proto3\"; package tutorial; // è¯¥packageå£°æ˜æ˜¯protoæ–‡ä»¶çš„å‘½åç©ºé—´ï¼Œåœ¨messageé‡åæ—¶èƒ½å¤Ÿé€šè¿‡å‘½åç©ºé—´è¿›è¡ŒåŒºåˆ† option go_package = \"github.com/yicixin/mysite/pb\"; ä¸ºäº†ç”Ÿæˆä»£ç ï¼Œè¿˜éœ€è¦å®‰è£…ä¸€äº›protoæ’ä»¶ï¼ˆprotoäºŒè¿›åˆ¶æ–‡ä»¶å·²æå‰å®‰è£…å¥½ï¼‰:\ngo install google.golang.org/protobuf/cmd/protoc-gen-go@latest æ¥ä¸‹æ¥ä½¿ç”¨protoå‘½ä»¤è¿›è¡Œç”Ÿæˆï¼Œ å› ä¸ºç”Ÿæˆçš„æ˜¯goä»£ç ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯â€“go_outï¼Œå…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼çš„é€‰é¡¹ï¼Œ$SRC_DIR (where your applicationâ€™s source code lives â€“ the current directory is used if you donâ€™t provide a value), the $DST_DIR (where you want the generated code to go; often the same asÂ $SRC_DIR), and the path to yourÂ .proto.\nprotoc -I=$SRC_DIR --go_out=$DST_DIR $SRC_DIR/addressbook.proto é«˜çº§é€‰é¡¹:\nè¯¦è§:https://developers.google.com/protocol-buffers/docs/reference/go-generated\nThe protocol buffer compiler produces Go output when invoked with theÂ go_outÂ flag. The argument to theÂ go_outÂ flag is the directory where you want the compiler to write your Go output.\nprotobufçš„ç¼–è¯‘å™¨å°†ç”Ÿæˆgoä»£ç ï¼Œå½“è°ƒç”¨æ—¶å¸¦ä¸Šäº†go_outæ ‡å¿—ï¼Œgo_outæ ‡å¿—çš„å‚æ•°æ˜¯ä½ æƒ³å­˜æ”¾goæ–‡ä»¶çš„ä½ç½®ã€‚\nprotoc --proto_path=. \\ --go_out=. --go_opt=paths=source_relative pb/address.proto Where in the output directory the generatedÂ .pb.goÂ file is placed depends on the compiler flags. There are several output modes:\nIf theÂ paths=importÂ flag is specified, the output file is placed in a directory named after the Go packageâ€™s import path. For example, an input fileÂ protos/buzz.protoÂ with a Go import path ofÂ example.com/project/protos/fizzÂ results in an output file atÂ example.com/project/protos/fizz/buzz.pb.go. This is the default output mode if aÂ pathsÂ flag is not specified. If theÂ module=$PREFIXÂ flag is specified, the output file is placed in a directory named after the Go packageâ€™s import path, but with the specified directory prefix removed from the output filename. For example, an input fileÂ protos/buzz.protoÂ with a Go import path ofÂ example.com/project/protos/fizzÂ andÂ example.com/projectÂ specified as theÂ moduleÂ prefix results in an output file atÂ protos/fizz/buzz.pb.go. Generating any Go packages outside the module path results in an error. This mode is useful for outputting generated files directly into a Go module. If theÂ paths=source_relativeÂ flag is specified, the output file is placed in the same relative directory as the input file. For example, an input fileÂ protos/buzz.protoÂ results in an output file atÂ protos/buzz.pb.go. å¼•ç”¨ Language Guide (proto3) | Protocol Buffers | Google Developers\n","wordCount":"665","inLanguage":"zh","datePublished":"2022-12-27T18:02:40+08:00","dateModified":"2022-12-27T18:02:40+08:00","author":[{"@type":"Person","name":"å£¹æ¬¡å¿ƒ"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yici.xin/post/tech/protobuf%E8%AF%AD%E6%B3%95/"},"publisher":{"@type":"Organization","name":"yicixin's blog","logo":{"@type":"ImageObject","url":"https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202211171234877.jpg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.yici.xin/ accesskey=h title="ğŸ‘€ (Alt + H)">ğŸ‘€</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.yici.xin/tags/ title=æ ‡ç­¾ğŸ·ï¸><span>æ ‡ç­¾ğŸ·ï¸</span></a></li><li><a href=https://www.yici.xin/archives/ title=å½’æ¡£ğŸ•°ï¸><span>å½’æ¡£ğŸ•°ï¸</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.yici.xin/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.yici.xin/post/>Posts</a>&nbsp;Â»&nbsp;<a href=https://www.yici.xin/post/tech/>ğŸ‘¨ğŸ»â€ğŸ’»æŠ€æœ¯</a></div><h1 class=post-title>Protobufè¯­æ³•</h1><div class=post-meta><span title='2022-12-27 18:02:40 +0800 +0800'>2022-12-27</span>&nbsp;Â·&nbsp;å£¹æ¬¡å¿ƒ&nbsp;|&nbsp;<a href=https://github.com/yicixin/blog/blob/main/content/post/tech/protobuf%e8%af%ad%e6%b3%95.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%afprotobuf aria-label=ä»€ä¹ˆæ˜¯protobufï¼Ÿ>ä»€ä¹ˆæ˜¯protobufï¼Ÿ</a></li><li><a href=#v3%e8%af%ad%e6%b3%95%e4%bb%8b%e7%bb%8d aria-label=V3è¯­æ³•ä»‹ç»>V3è¯­æ³•ä»‹ç»</a></li><li><a href=#%e7%94%9f%e6%88%90%e4%bb%a3%e7%a0%81-%e4%bb%a5go%e4%b8%ba%e4%be%8b aria-label=ç”Ÿæˆä»£ç -ä»¥goä¸ºä¾‹>ç”Ÿæˆä»£ç -ä»¥goä¸ºä¾‹</a></li><li><a href=#%e5%bc%95%e7%94%a8 aria-label=å¼•ç”¨>å¼•ç”¨</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=ä»€ä¹ˆæ˜¯protobuf>ä»€ä¹ˆæ˜¯protobufï¼Ÿ<a hidden class=anchor aria-hidden=true href=#ä»€ä¹ˆæ˜¯protobuf>#</a></h2><p>ä¸€ç§åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹å¼ï¼Œä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•ã€‚å’Œjsonä¸€æ ·ï¼Œä½†æ˜¯æ›´å°æ›´å¿«ã€‚</p><h2 id=v3è¯­æ³•ä»‹ç»>V3è¯­æ³•ä»‹ç»<a hidden class=anchor aria-hidden=true href=#v3è¯­æ³•ä»‹ç»>#</a></h2><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„è¯·æ±‚å‚æ•°ï¼Œæ–°å»ºä¸€ä¸ª.protoæ–‡ä»¶å¹¶å†™å…¥:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchRequest</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> query <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>int32</span> page_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>int32</span> page_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><blockquote><p>.protoæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†å½“å‰æ­£åœ¨ä½¿ç”¨proto3è¯­æ³•ï¼Œå¦‚æœæœªå†™ï¼Œprotoçš„ç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨proto2çš„è¯­æ³•è¿›è¡Œè§£æã€‚</p></blockquote><p><code>SearchRequest</code>å®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼Œå®ƒä»¬éƒ½æœ‰ç±»å‹å’Œåç§°ï¼Œå¹¶ä¸”åœ¨æœ€åç»™äº†ä¸€ä¸ªå”¯ä¸€ç¼–å·ï¼Œç¼–å·çš„ä½œç”¨æ˜¯åœ¨åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶åºåˆ—ä¸­æ ‡è¯†å­—æ®µã€‚å½“ç¼–å·ä¸º1-15çš„èŒƒå›´å†…æ—¶ï¼Œåœ¨ç¼–ç æ—¶åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ16-2047å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› å¯ä»¥äº†è§£ä¸€ä¸‹protobufçš„ç¼–ç åŸç†ã€‚æ‰€ä»¥ï¼Œ1-15çš„ç¼–å·æœ€å¥½è¦ä¿ç•™ç»™é‚£äº›æœ€ç»å¸¸å‡ºç°çš„å­—æ®µã€‚ä½ èƒ½ä½¿ç”¨çš„æœ€å°ç¼–å·æ˜¯1ï¼Œæœ€å¤§æ˜¯$2^{29}$-1ï¼Œä¸è¿‡ä½ ä¸èƒ½ä½¿ç”¨19000-19999ï¼Œè¿™äº›ç¼–å·ä¸ºprotobufçš„å®ç°è€Œé¢„ä¿ç•™äº†ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ï¼Œæ˜¯è¿‡ä¸äº†ç¼–è¯‘çš„ã€‚</p><p>åœ¨å•ä¸ª.protoæ–‡ä»¶ä¸­èƒ½å®šä¹‰å¤šä¸ªmessageç±»å‹:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchRequest</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>string</span> query <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchResponse</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>repeated</span> <span style=color:#66d9ef>string</span> data <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> total <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><code>repeated</code>è¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¯é‡å¤å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ã€‚</p><p>æ³¨é‡Šçš„å†™æ³•:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>/* è¯·æ±‚ç»“æ„ */</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchRequest</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>string</span> query <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>/* å“åº”ç»“æ„ */</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchResponse</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>repeated</span> <span style=color:#66d9ef>string</span> data <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> total <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>; <span style=color:#75715e>// æ€»æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬åœ¨æ›´æ–°message typeæ—¶ï¼Œæ˜¯ç›´æ¥åˆ é™¤æˆ–è€…æ³¨é‡Šäº†å­—æ®µï¼Œåœ¨ä¹‹åå…¶ä»–äººæ¥æ›´æ–°æ—¶å¯èƒ½ä¼šå¤ç”¨è¢«åˆ é™¤æˆ–æ³¨é‡Šçš„å­—æ®µç¼–å·ï¼Œå¦‚æœè¿™æ—¶åŠ è½½äº†ç›¸åŒprotoçš„æ—§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ‰€ä»¥protobufæä¾›äº†ä¿ç•™å­—æ®µçš„æœºåˆ¶ï¼Œä½¿ç”¨<code>reserved</code>å…³é”®å­—ï¼Œå¯ä»¥ä¿ç•™ç¼–å·æˆ–è€…å­—æ®µåã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Foo</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    reserved <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>9</span> <span style=color:#66d9ef>to</span> <span style=color:#ae81ff>11</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    reserved <span style=color:#e6db74>&#34;foo&#34;</span>, <span style=color:#e6db74>&#34;bar&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> foo <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>; <span style=color:#75715e>// ä¼šæŠ¥é”™
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>æšä¸¾:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#75715e>/* è¯·æ±‚ç»“æ„ */</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchRequest</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>string</span> query <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>enum</span> Corpus {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        UNIVERSAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        WEB <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        IMAGES <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        LOCAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        NEWS <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        PRODUCTS <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        VIDEO <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Corpus corpus <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæšä¸¾çš„ç¬¬ä¸€ä¸ªå­—æ®µå€¼å¿…é¡»ä¸º0ï¼Œå› ä¸ºè¿™æ ·æˆ‘ä»¬å°±èƒ½ç”¨0ä½œä¸ºæ•°å­—ç¼–å·çš„é»˜è®¤å€¼ï¼Œå¹¶ä¸”ä¸ºäº†å…¼å®¹proto2ï¼Œæšä¸¾çš„ç¬¬ä¸€ä¸ªå­—æ®µå³ä¸ºé»˜è®¤å€¼ã€‚</p><p>æšä¸¾çš„åˆ«åï¼Œå¦‚æœæŸæ—¶å€™å¸Œæœ›å¤šä¸ªæšä¸¾å­—æ®µä»£è¡¨åŒä¸€ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨åˆ«åæœºåˆ¶ï¼Œéœ€è¦è®¾ç½®<code>option allow_alias</code>ä¸º<code>true</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>/* è¯·æ±‚ç»“æ„ */</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>SearchRequest</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>string</span> query <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>int32</span> page_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>enum</span> Corpus {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        UNIVERSAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        WEB <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        IMAGES <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        LOCAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        NEWS <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        PRODUCTS <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        VIDEO <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Corpus corpus <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>enum</span> Corpus {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    UNIVERSAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    WEB <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    IMAGES <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    LOCAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    NEWS <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    PRODUCTS <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    VIDEO <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>MyMessage1</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>enum</span> EnumAllowingAlias {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      <span style=color:#66d9ef>option</span> allow_alias <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>; <span style=color:#75715e>// å…è®¸åˆ«å
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      UNKNOWN <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      STARTED <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      RUNNING <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    EnumAllowingAlias <span style=color:#66d9ef>enum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    SearchRequest.Corpus corpus <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Corpus corpus2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>å¦‚ä¸Šï¼Œæšä¸¾çš„å£°æ˜å¯ä»¥ä¸åœ¨messageçš„å£°æ˜ä¸­ï¼Œåœ¨ä¸€ä¸ªmessageä¸­ä¹Ÿå¯ä»¥å¼•ç”¨å…¶ä»–messageä¸­å£°æ˜çš„æšä¸¾ã€‚</p><p>æšä¸¾å€¼çš„èŒƒå›´æ˜¯ä¸€ä¸ª32ä½çš„intï¼Œå› ä¸ºæšä¸¾åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯å˜é•¿ç¼–ç ï¼Œæ‰€ä»¥è´Ÿæ•°æ˜¯å¾ˆä½æ•ˆçš„ï¼Œä¸æ¨èã€‚</p><p>å¯¼å…¥å…¶ä»–.protoæ–‡ä»¶ï¼Œå…ˆåœ¨golandä¸­é…ç½®protoå¯»æ‰¾è·¯å¾„ï¼Œæ·»åŠ æœ¬åœ°é¡¹ç›®åœ°å€ã€‚
<img loading=lazy src=https://yicixin-blog-image.oss-accelerate.aliyuncs.com/img/202212271805382.png alt></p><p>ä¹‹ååœ¨.protoæ–‡ä»¶ä¸­ä½¿ç”¨importå…³é”®å­—è¿›è¡Œå¯¼å…¥:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;pb/route_guide.proto&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>æ­¤æ—¶æ ¹è·¯å¾„ä¸ºé¡¹ç›®æ ¹ç›®å½•</p><p>protoä¸­çš„map:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>M</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    map&lt;<span style=color:#66d9ef>string</span>, SearchRequest&gt; req_map <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>or<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>MapFieldEntry</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  key_type key <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  value_type value <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>repeated</span> MapFieldEntry map_field <span style=color:#f92672>=</span> N;<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>æ³¨æ„:</p><ol><li>Map fields cannot beÂ <code>repeated</code>.</li><li>Mapä¸­çš„æ•°æ®é¡ºåºä¸æ˜¯å›ºå®šçš„</li></ol><h2 id=ç”Ÿæˆä»£ç -ä»¥goä¸ºä¾‹>ç”Ÿæˆä»£ç -ä»¥goä¸ºä¾‹<a hidden class=anchor aria-hidden=true href=#ç”Ÿæˆä»£ç -ä»¥goä¸ºä¾‹>#</a></h2><p>è¦ç”Ÿæˆgoä»£ç ï¼Œæˆ‘ä»¬è¦åœ¨protoæ–‡ä»¶é‡Œæ·»åŠ <code>option go_package</code>çš„å®šä¹‰ï¼Œ The option defines the import path of the package which will contain all the generated code for this file, the Go package name will be the last path component of the import path.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#f92672>package</span> tutorial; <span style=color:#75715e>// è¯¥packageå£°æ˜æ˜¯protoæ–‡ä»¶çš„å‘½åç©ºé—´ï¼Œåœ¨messageé‡åæ—¶èƒ½å¤Ÿé€šè¿‡å‘½åç©ºé—´è¿›è¡ŒåŒºåˆ†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>option</span> go_package <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github.com/yicixin/mysite/pb&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>ä¸ºäº†ç”Ÿæˆä»£ç ï¼Œè¿˜éœ€è¦å®‰è£…ä¸€äº›protoæ’ä»¶ï¼ˆprotoäºŒè¿›åˆ¶æ–‡ä»¶å·²æå‰å®‰è£…å¥½ï¼‰:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ä½¿ç”¨protoå‘½ä»¤è¿›è¡Œç”Ÿæˆï¼Œ å› ä¸ºç”Ÿæˆçš„æ˜¯goä»£ç ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯&ndash;go_outï¼Œå…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼çš„é€‰é¡¹ï¼Œ<code>$SRC_DIR</code> (where your application&rsquo;s source code lives â€“ the current directory is used if you don&rsquo;t provide a value), the <code>$DST_DIR</code> (where you want the generated code to go; often the same asÂ <code>$SRC_DIR</code>), and the path to yourÂ <code>.proto</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc -I<span style=color:#f92672>=</span>$SRC_DIR --go_out<span style=color:#f92672>=</span>$DST_DIR $SRC_DIR/addressbook.proto
</span></span></code></pre></div><p>é«˜çº§é€‰é¡¹:</p><blockquote><p>è¯¦è§:<a href=https://developers.google.com/protocol-buffers/docs/reference/go-generated>https://developers.google.com/protocol-buffers/docs/reference/go-generated</a></p></blockquote><p>The protocol buffer compiler produces Go output when invoked with theÂ <code>go_out</code>Â flag. The argument to theÂ <code>go_out</code>Â flag is the directory where you want the compiler to write your Go output.</p><p>protobufçš„ç¼–è¯‘å™¨å°†ç”Ÿæˆgoä»£ç ï¼Œå½“è°ƒç”¨æ—¶å¸¦ä¸Šäº†<code>go_out</code>æ ‡å¿—ï¼Œgo_outæ ‡å¿—çš„å‚æ•°æ˜¯ä½ æƒ³å­˜æ”¾goæ–‡ä»¶çš„ä½ç½®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc --proto_path<span style=color:#f92672>=</span>. <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--go_out<span style=color:#f92672>=</span>. --go_opt<span style=color:#f92672>=</span>paths<span style=color:#f92672>=</span>source_relative pb/address.proto
</span></span></code></pre></div><p>Where in the output directory the generatedÂ <code>.pb.go</code>Â file is placed depends on the compiler flags. There are several output modes:</p><ul><li>If theÂ <code>paths=import</code>Â flag is specified, the output file is placed in a directory named after the Go package&rsquo;s import path. For example, an input fileÂ <code>protos/buzz.proto</code>Â with a Go import path ofÂ <code>example.com/project/protos/fizz</code>Â results in an output file atÂ <code>example.com/project/protos/fizz/buzz.pb.go</code>. This is the default output mode if aÂ <code>paths</code>Â flag is not specified.</li><li>If theÂ <code>module=$PREFIX</code>Â flag is specified, the output file is placed in a directory named after the Go package&rsquo;s import path, but with the specified directory prefix removed from the output filename. For example, an input fileÂ <code>protos/buzz.proto</code>Â with a Go import path ofÂ <code>example.com/project/protos/fizz</code>Â andÂ <code>example.com/project</code>Â specified as theÂ <code>module</code>Â prefix results in an output file atÂ <code>protos/fizz/buzz.pb.go</code>. Generating any Go packages outside the module path results in an error. This mode is useful for outputting generated files directly into a Go module.</li><li>If theÂ <code>paths=source_relative</code>Â flag is specified, the output file is placed in the same relative directory as the input file. For example, an input fileÂ <code>protos/buzz.proto</code>Â results in an output file atÂ <code>protos/buzz.pb.go</code>.</li></ul><h2 id=å¼•ç”¨>å¼•ç”¨<a hidden class=anchor aria-hidden=true href=#å¼•ç”¨>#</a></h2><p><a href=https://developers.google.com/protocol-buffers/docs/proto3>Language Guide (proto3) | Protocol Buffers | Google Developers</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.yici.xin/tags/protobuf/>protobuf</a></li></ul><nav class=paginav><a class=prev href=https://www.yici.xin/post/tech/wire-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Wire ä¾èµ–æ³¨å…¥</span></a>
<a class=next href=https://www.yici.xin/post/tech/protobuf%E5%8E%9F%E7%90%86/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>ProtobufåŸç†</span></a></nav></footer><script type=text/javascript>let giscusTheme=localStorage.getItem("pref-theme")==="dark"?"dark_dimmed":"light",giscusAttributes={src:"https://giscus.app/client.js","data-repo":"yicixin/blog_comment","data-repo-id":"R_kgDOIr6QyQ","data-category":"Announcements","data-category-id":"DIC_kwDOIr6Qyc4CTSs3","data-mapping":"title","data-reactions-enabled":"1","data-emit-metadata":"0","data-theme":giscusTheme===null?"light":giscusTheme,"data-lang":"zh-CN",crossorigin:"anonymous","data-loading":"lazy",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t));var article=document.getElementsByTagName("article")[0].appendChild(giscusScript);function changeGiscusTheme(){const e=localStorage.getItem("pref-theme")==="dark"?"light":"dark_dimmed";function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}const toggle=document.querySelector("#theme-toggle");toggle&&toggle.addEventListener("click",changeGiscusTheme)</script><script src=https://giscus.app/client.js data-repo=yicixin/blog_comment data-repo-id=R_kgDOIr6QyQ data-category=Announcements data-category-id=DIC_kwDOIr6Qyc4CTSs3 data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.yici.xin/>yicixin's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="ctrl\u002bc";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="ctrl\u002bc"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://code.jquery.com/jquery-1.12.4.min.js></script>
<script>$("code[class^=language] ").on("mouseover",function(){this.clientWidth<this.scrollWidth&&$(this).css("width","135%")}).on("mouseout",function(){$(this).css("width","100%"),$(".copy-code").css("right","4px")})</script></body></html>